<!DOCTYPE html>
<html lang="en" >
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta charset="utf-8">
<title>Parsing the Message</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1023" />
<meta name="description" content="This chapter explains the types of parsers included with the Oracle GoldenGate Java Adapter and how each parser translates JMS text messages." />
<meta name="dcterms.created" content="2015-04-08T9:18:57Z" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="GoldenGate Application Adapters Administering Oracle GoldenGate Adapters" />
<meta name="dcterms.identifier" content="E61853-01" />
<meta name="dcterms.isVersionOf" content="GADAD" />
<link rel="Start" href="../../index.htm" title="Home" type="text/html" />
<link rel="Copyright" href="../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Prev" href="java_msgcap_config.htm" title="Previous" type="text/html" />
<link rel="Next" href="java_msgcap_properties.htm" title="Next" type="text/html" />
<link rel="alternate" href="E61853-01.pdf" title="PDF version" type="application/pdf" />
<link rel="alternate" href="E61853-01.epub" title="ePub version" type="application/epub+zip" />
<link rel="alternate" href="E61853-01.mobi" title="Mobipocket version" type="application/x-mobipocket-ebook" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../dcommon/css/fonts.css">
<link rel="stylesheet" href="../dcommon/css/foundation.css">
<link rel="stylesheet" href="../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css">
<link rel="stylesheet" href="../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>

                    <script>var w=window;if(w.performance||w.mozPerformance||w.msPerformance||w.webkitPerformance){var d=document;AKSB=w.AKSB||{},AKSB.q=AKSB.q||[],AKSB.mark=AKSB.mark||function(e,_){AKSB.q.push(["mark",e,_||(new Date).getTime()])},AKSB.measure=AKSB.measure||function(e,_,t){AKSB.q.push(["measure",e,_,t||(new Date).getTime()])},AKSB.done=AKSB.done||function(e){AKSB.q.push(["done",e])},AKSB.mark("firstbyte",(new Date).getTime()),AKSB.prof={custid:"322179",ustr:"",originlat:"0",clientrtt:"1",ghostip:"23.212.3.15",ipv6:false,pct:"10",clientip:"45.78.37.67",requestid:"29fe0268",region:"32996",protocol:"",blver:14,akM:"dsca",akN:"ae",akTT:"O",akTX:"1",akTI:"29fe0268",ai:"206465",ra:"false",pmgn:"",pmgi:"",pmp:"",qc:""},function(e){var _=d.createElement("script");_.async="async",_.src=e;var t=d.getElementsByTagName("script"),t=t[t.length-1];t.parentNode.insertBefore(_,t)}(("https:"===d.location.protocol?"https:":"http:")+"//ds-aksb-a.akamaihd.net/aksb.min.js")}</script>
                    <script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script></head>
<body>
<a href="#BEGIN" class="accessibility-top skipto" tabindex="0">Go to main content</a>
<header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Go to main content</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns" dir="ltr">
<a id="BEGIN" name="BEGIN"></a>
<span id="PAGE" style="display:none;">16/28</span> <!-- End Header -->
<div id="GADAD138" class="chapter"><a id="CHDFAICD"></a>
<h1 class="chapter"><span class="secnum">10</span> Parsing the Message</h1>
<p><a id="GADAD540"></a>This chapter explains the types of parsers included with the Oracle GoldenGate Java Adapter and how each parser translates JMS text messages.</p>
<p>This chapter includes the following sections:</p>
<ul>
<li>
<p><a href="#s_e_d_m_a_j">Parsing Overview</a></p>
</li>
<li>
<p><a href="#A999738">Fixed Width Parsing</a></p>
</li>
<li>
<p><a href="#A1000758">Delimited parsing</a></p>
</li>
<li>
<p><a href="#A1001531">XML Parsing</a></p>
</li>
<li>
<p><a href="#A1005173">Source definitions Generation Utility</a></p>
</li>
</ul>
<a id="s_e_d_m_a_j"></a>
<div id="GADAD139" class="sect1">
<h2 class="sect1"><span class="secnum">10.1</span> Parsing Overview</h2>
<p>The role of the parser is to translate JMS text message data and header properties into an appropriate set of transactions and operations to pass into the VAM interface. To do this, the parser always must find certain data:</p>
<ul>
<li>
<p>Transaction identifier</p>
</li>
<li>
<p>Sequence identifier</p>
</li>
<li>
<p>Timestamp</p>
</li>
<li>
<p>Table name</p>
</li>
<li>
<p>Operation type</p>
</li>
<li>
<p>Column data specific to a particular table name and operation type</p>
</li>
</ul>
<p>Other data will be used if the configuration requires it:</p>
<ul>
<li>
<p>Transaction indicator</p>
</li>
<li>
<p>Transaction name</p>
</li>
<li>
<p>Transaction owner</p>
</li>
</ul>
<p>The parser can obtain this data from JMS header properties, system generated values, static values, or in some parser-specific way. This depends on the nature of the piece of information.</p>
<div id="GADAD140" class="sect2"><a id="sthref133"></a>
<h3 class="sect2"><span class="secnum">10.1.1</span> Parser Types</h3>
<p>The Oracle GoldenGate message capture adapter supports three types of parsers:</p>
<ul>
<li>
<p>Fixed &ndash; Messages contain data presented as fixed width fields in contiguous text.</p>
</li>
<li>
<p>Delimited &ndash; Messages contain data delimited by field and end of record characters.</p>
</li>
<li>
<p>XML &ndash; Messages contain XML data accessed through XPath expressions.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<div id="GADAD141" class="sect2"><a id="sthref134"></a>
<h3 class="sect2"><span class="secnum">10.1.2</span> Source and Target Data Definitions</h3>
<p>There are several ways source data definitions can be defined using a combination of properties and external files. The Oracle GoldenGate Gendef utility generates a standard source definitions file based on these data definitions and parser properties. The options vary based on parser type:</p>
<ul>
<li>
<p>Fixed &ndash; COBOL copybook, source definitions or user defined</p>
</li>
<li>
<p>Delimited &ndash; source definitions or user defined</p>
</li>
<li>
<p>XML &ndash; source definitions or user defined</p>
</li>
</ul>
<p>There are several properties that configure how the selected parser gets data and how the source definitions are converted to target definitions.</p>
</div>
<!-- class="sect2" -->
<div id="GADAD142" class="sect2"><a id="sthref135"></a>
<h3 class="sect2"><span class="secnum">10.1.3</span> Required Data</h3>
<p>The following information is required for the parsers to translate the messages:</p>
<div id="GADAD143" class="sect3"><a id="sthref136"></a>
<h4 class="sect3"><span class="secnum">10.1.3.1</span> Transaction Identifier</h4>
<p>The transaction identifier (<code>txid</code>) groups operations into transactions as they are written to the Oracle GoldenGate trail file. The Oracle GoldenGate message capture adapter supports only contiguous, non-interleaved transactions. The transaction identifier can be any unique value that increases for each transaction. A system generated value can generally be used.</p>
</div>
<!-- class="sect3" -->
<div id="GADAD144" class="sect3"><a id="sthref137"></a>
<h4 class="sect3"><span class="secnum">10.1.3.2</span> Sequence Identifier</h4>
<p>The sequence identifier (<code>seqid</code>) identifies each operation internally. This can be used during recovery processing to identify operations that have already been written to the Oracle GoldenGate trail. The sequence identifier can be any unique value that increases for each operation. The length should be fixed.</p>
<p>The JMS Message ID can be used as a sequence identifier if the message identifier for that provider increases and is unique. However, there are cases (e.g. using clustering, failed transactions) where JMS does not guarantee message order or when the ID may be unique but not be increasing. The system generated Sequence ID can be used, but it can cause duplicate messages under some recovery situations. The recommended approach is to have the JMS client that adds messages to the queue set the Message ID, a header property, or some data element to an application-generated unique value that is increasing.</p>
</div>
<!-- class="sect3" -->
<div id="GADAD145" class="sect3"><a id="sthref138"></a>
<h4 class="sect3"><span class="secnum">10.1.3.3</span> Timestamp</h4>
<p>The timestamp (<code>timestamp</code>) is used as the commit timestamp of operations within the Oracle GoldenGate trail. It should be increasing but this is not required, and it does not have to be unique between transactions or operations. It can be any date format that can be parsed.</p>
</div>
<!-- class="sect3" -->
<div id="GADAD146" class="sect3"><a id="sthref139"></a>
<h4 class="sect3"><span class="secnum">10.1.3.4</span> Table Name</h4>
<p>The table name is used to identify the logical table to which the column data belongs. The adapter requires a two part table name in the form <code>SCHEMA_NAME.TABLE_NAME</code>. This can either be defined separately (<code>schema and table</code>) or as a combination of schema and table (<code>schemaandtable</code>).</p>
<p>A single field may contain both schema and table name, they may be in separate fields, or the schema may be included in the software code so only the table name is required. How the schema and table names can be specified depends on the parser. In any case the two part logical table name is used to write records in the Oracle GoldenGate trail and to generate the source definitions file that describes the trail.</p>
</div>
<!-- class="sect3" -->
<div id="GADAD147" class="sect3"><a id="sthref140"></a>
<h4 class="sect3"><span class="secnum">10.1.3.5</span> Operation Type</h4>
<p>The operation type (<code>optype</code>) is used to determine whether an operation is an insert, update or delete when written to the Oracle GoldenGate trail. The operation type value for any specific operation is matched against the values defined for each operation type.</p>
<p>The data written to the Oracle GoldenGate trail for each operation type depends on the Extract configuration:</p>
<ul>
<li>
<p>Inserts</p>
<ul>
<li>
<p>The after values of all columns are written to the trail.</p>
</li>
</ul>
</li>
<li>
<p>Updates</p>
<ul>
<li>
<p>Default &ndash; The after values of keys are written. The after values of columns that have changed are written if the before values are present and can be compared. If before values are not present then all columns are written.</p>
</li>
<li>
<p><code>NOCOMPRESSUPDATES</code> &ndash; The after values of all columns are written to the trail.</p>
</li>
<li>
<p><code>GETUPDATEBEFORES</code> &ndash; The before and after values of columns that have changed are written to the trail if the before values are present and can be compared. If before values are not present only after values are written.</p>
</li>
<li>
<p>If both <code>NOCOMPRESSUPDATES</code> and <code>GETUPDATEBEFORES</code> are included, the before and after values of all columns are written to the trail if before values are present</p>
</li>
</ul>
</li>
<li>
<p>Deletes</p>
<ul>
<li>
<p>Default &ndash; The before values of all keys are written to the trail.</p>
</li>
<li>
<p><code>NOCOMPRESSDELETES</code> &ndash; The before values of all columns are written to the trail.</p>
</li>
</ul>
</li>
</ul>
<p>Primary key update operations may also be generated if the before values of keys are present and do not match the after values.</p>
</div>
<!-- class="sect3" -->
<div id="GADAD148" class="sect3"><a id="sthref141"></a>
<h4 class="sect3"><span class="secnum">10.1.3.6</span> Column Data</h4>
<p>All parsers retrieve column data from the message text and write it to the Oracle GoldenGate trail. In some cases the columns are read in index order as defined by the source definitions, in other cases they are accessed by name.</p>
<p>Depending on the configuration and original message text, both before and after or only after images of the column data may be available. For updates, the data for non-updated columns may or may not be available.</p>
<p>All column data is retrieved as text. It is converted internally into the correct data type for that column based on the source definitions. Any conversion problem will result in an error and the process will abend.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<div id="GADAD149" class="sect2"><a id="sthref142"></a>
<h3 class="sect2"><span class="secnum">10.1.4</span> Optional Data</h3>
<p>The following data may be included, but is not required.</p>
<div id="GADAD150" class="sect3"><a id="sthref143"></a>
<h4 class="sect3"><span class="secnum">10.1.4.1</span> Transaction Indicator</h4>
<p>The relationship of transactions to messages can be:</p>
<ul>
<li>
<p>One transaction per message</p>
<p>This is determined automatically by the scope of the message.</p>
</li>
<li>
<p>Multiple transactions per message</p>
<p>This is determined by the transaction indicator (<code>txind</code>). If there is no transaction indicator, the XML parser can create transactions based on a matching transaction rule.</p>
</li>
<li>
<p>Multiple messages per transaction</p>
<p>The transaction indicator (<code>txind</code>) is required to specify whether the operation is the beginning, middle, end or the whole transaction. The transaction indicator value for any specific operation is matched against the values defined for each transaction indicator type. A transaction is started if the indicator value is beginning or whole, continued if it is middle, and ended if it is end or whole.</p>
</li>
</ul>
</div>
<!-- class="sect3" -->
<div id="GADAD151" class="sect3"><a id="sthref144"></a>
<h4 class="sect3"><span class="secnum">10.1.4.2</span> Transaction Name</h4>
<p>The transaction name (<code>txname</code>) is optional data that can be used to associate an arbitrary name to a transaction. This can be added to the trail as a token using a <code>GETENV</code> function.</p>
</div>
<!-- class="sect3" -->
<div id="GADAD152" class="sect3"><a id="sthref145"></a>
<h4 class="sect3"><span class="secnum">10.1.4.3</span> Transaction Owner</h4>
<p>The transaction owner (txowner) is optional data that can be used to associate an arbitrary user name to a transaction. This can be added to the trail as a token using a <code>GETENV</code> function, or used to exclude certain transactions from processing using the <code>EXCLUDEUSER</code> Extract parameter.</p>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="A999738"></a>
<div id="GADAD153" class="sect1">
<h2 class="sect1"><span class="secnum">10.2</span> Fixed Width Parsing</h2>
<p>Fixed width parsing is based on a data definition that defines the position and the length of each field. This is in the format of a Cobol copybook. A set of properties define rules for mapping the copybook to logical records in the Oracle GoldenGate trail and in the source definitions file.</p>
<p>The incoming data should consist of a standard format header followed by a data segment. Both should contain fixed width fields. The data is parsed based on the PIC definition in the copybook. It is written to the trail translated as explained in <a href="#i1018152">Section 10.2.2, "Header and Record Data Type Translation."</a></p>
<div id="GADAD154" class="sect2"><a id="sthref146"></a>
<h3 class="sect2"><span class="secnum">10.2.1</span> Header</h3>
<p>The header must be defined by a copybook 01 level record that includes the following:</p>
<ul>
<li>
<p>A commit timestamp or a change time for the record</p>
</li>
<li>
<p>A code to indicate the type of operation: insert, update, or delete</p>
</li>
<li>
<p>The copybook record name to use when parsing the data segment</p>
</li>
</ul>
<p>Any fields in the header record that are not mapped to Oracle GoldenGate header fields are output as columns.</p>
<p>The following example shows a copybook definition containing the required header values</p>
<div id="GADAD155" class="example">
<p class="titleinexample"><a id="sthref147"></a>Example 10-1 Specifying a Header</p>
<pre>
01 HEADER.
20 Hdr-Timestamp            PIC X(23)
20 Hdr-Source-DB-Function PIC X
20 Hdr-Source-DB-Rec-ID    PIC X(8)
</pre>
<p>For the above example, you must set the following properties:</p>
<pre>
fixed.header=HEADER
fixed.timestamp=Hdr-Timestamp
fixed.optype=Hdr-Source-DB-Function
fixed.table=Hdr-Source-DB-Rec-Id
</pre>
<p>The logical name table output in this case will be the value of <code>Hdr-Source-DB-Rec-Id</code>.</p>
</div>
<!-- class="example" -->
<div id="GADAD156" class="sect3"><a id="sthref148"></a>
<h4 class="sect3"><span class="secnum">10.2.1.1</span> Specifying Compound Table Names</h4>
<p>More than one field can be used for a table name. For example, you can define the logical schema name through a static property such as:</p>
<pre>
fixed.schema=MYSCHEMA
</pre>
<p>Then you can add a property that defines the data record as multiple fields from the copybook header definition.</p>
<div id="GADAD157" class="example">
<p class="titleinexample"><a id="sthref149"></a>Example 10-2 Specifying Compound Table Names</p>
<pre>
01  HEADER.
    20  Hdr-Source-DB              PIC X(8).
    20  Hdr-Source-DB-Rec-Id       PIC X(8).
    20  Hdr-Source-DB-Rec-Version  PIC 9(4).
    20  Hdr-Source-DB-Function     PIC X.
    20  Hdr-Timestamp              PIC X(22).
</pre>
<p>For the above example, you must set the following properties:</p>
<pre>
fixed.header=HEADER
fixed.table=Hdr-Source-DB-Rec-Id,Hdr-Source-DB-Rec-Version
fixed.schema=MYSCHEMA
</pre>
<p>The fields will be concatenated to result in logical schema and table names of the form:</p>
<pre>
MYSCHEMA.Hdr-Source-DB-Rec-Id+Hdr-Source-DB-Rec-Version
</pre></div>
<!-- class="example" --></div>
<!-- class="sect3" -->
<div id="GADAD158" class="sect3"><a id="sthref150"></a>
<h4 class="sect3"><span class="secnum">10.2.1.2</span> Specifying timestamp Formats</h4>
<p>A timestamp is parsed using the default format <code>YYYY-MM-DD HH:MM:SS.FFF</code>, with <code>FFF</code> depending on the size of the field.</p>
<p>Specify different incoming formats by entering a comment before the datetime field as shown in the next example.</p>
<div id="GADAD159" class="example">
<p class="titleinexample"><a id="sthref151"></a>Example 10-3 Specifying timestamp formats</p>
<pre>
01  HEADER. 
* DATEFORMAT YYYY-MM-DD-HH.MM.SS.FF
    20  Hdr-Timestamp       PIC X(23)
</pre></div>
<!-- class="example" --></div>
<!-- class="sect3" -->
<div id="GADAD160" class="sect3"><a id="sthref152"></a>
<h4 class="sect3"><span class="secnum">10.2.1.3</span> Specifying the Function</h4>
<p>Use properties to map the standard Oracle GoldenGate operation types to the <code>optype</code> values. The following example specifies that the operation type is in the <code>Hdr-Source-DB-Function</code> field and that the value for insert is <code>A</code>, update is <code>U</code> and delete is <code>D</code>.</p>
<div id="GADAD161" class="example">
<p class="titleinexample"><a id="sthref153"></a>Example 10-4 Specifying the Function</p>
<pre>
fixed.optype=Hdr-Source-DB-Function
fixed.optype.insert=A
fixed.optype.update=U
fixed.optype.delete=D
</pre></div>
<!-- class="example" --></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1018152"></a>
<div id="GADAD162" class="sect2">
<h3 class="sect2"><span class="secnum">10.2.2</span> Header and Record Data Type Translation</h3>
<p>The data in the header and the record data are written to the trail based on the translated data type.</p>
<ul>
<li>
<p>A field definition preceded by a date format comment is translated to an Oracle GoldenGate datetime field of the specified size. If there is no date format comment, the field will be defined by its underlying data type.</p>
</li>
<li>
<p>A <code>PIC X</code> field is translated to the <code>CHAR</code> data type of the indicated size.</p>
</li>
<li>
<p>A <code>PIC 9</code> field is translated to a <code>NUMBER</code> data type with the defined precision and scale. Numbers that are signed or unsigned and those with or without decimals are supported.</p>
</li>
</ul>
<p>The following examples show the translation for various <code>PIC</code> definitions.</p>
<div class="inftblhruleinformal">
<table class="cellalignment13" title="Example Translations for PIC Definitions" summary="This two column table shows examples of the translation from PIC to Oracle GoldenGate datatypes." dir="ltr">
<thead>
<tr class="cellalignment2">
<th class="cellalignment14" id="r1c1-t2">Input</th>
<th class="cellalignment14" id="r1c2-t2">Output</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2">
<td class="cellalignment8" id="r2c1-t2" headers="r1c1-t2">
<pre>
PIC XX
</pre></td>
<td class="cellalignment8" headers="r2c1-t2 r1c2-t2">
<pre>
CHAR(2)
</pre></td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment8" id="r3c1-t2" headers="r1c1-t2">
<pre>
PIC X(16)
</pre></td>
<td class="cellalignment8" headers="r3c1-t2 r1c2-t2">
<pre>
CHAR(16)
</pre></td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment8" id="r4c1-t2" headers="r1c1-t2">
<pre>
PIC 9(4)
</pre></td>
<td class="cellalignment8" headers="r4c1-t2 r1c2-t2">
<pre>
NUMBER(4)
</pre></td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment8" id="r5c1-t2" headers="r1c1-t2">
<pre>
* YYMMDD
PIC 9(6)
</pre></td>
<td class="cellalignment8" headers="r5c1-t2 r1c2-t2">
<pre>
DATE(10)
YYYY-MM-DD
</pre></td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment8" id="r6c1-t2" headers="r1c1-t2">
<pre>
PIC 99.99
</pre></td>
<td class="cellalignment8" headers="r6c1-t2 r1c2-t2">
<pre>
NUMBER(4,2)
</pre></td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment8" id="r7c1-t2" headers="r1c1-t2">
<pre>
PIC 9(5)V99
</pre></td>
<td class="cellalignment8" headers="r7c1-t2 r1c2-t2">
<pre>
NUMBER(7,2)
</pre></td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblhruleinformal" -->
<p>In the example an input <code>YYMMDD</code> date of 100522 is translated to 2010-05-22. The number 1234567 with the specified format <code>PIC 9(5)V99</code> is translated to a seven digit number with two decimal places, or 12345.67.</p>
</div>
<!-- class="sect2" -->
<div id="GADAD163" class="sect2"><a id="sthref154"></a>
<h3 class="sect2"><span class="secnum">10.2.3</span> Key identification</h3>
<p>A comment is used to identify key columns within the data record. The Gendef utility that generates the source definitions uses the comment to locate a key column.</p>
<p>In the following example <code>Account</code> has been marked as a key column for <code>TABLE1</code>.</p>
<pre>
01 TABLE1
* KEY
20  Account      PIC X(19)
20  PAN_Seq_Num PIC 9(3)
</pre></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="A1000758"></a>
<div id="GADAD164" class="sect1">
<h2 class="sect1"><span class="secnum">10.3</span> Delimited parsing</h2>
<p>Delimited parsing is based a preexisting source definitions files and a set of properties. The properties specify the delimiters to use and other rules, such as whether there are column names and before values. The source definitions file determines the valid tables to be processed and the order and data type of the columns in the tables.</p>
<p>The format of the delimited message is:</p>
<pre>
{<span class="italic">METACOLS</span>}<span class="superscript">n</span>[,{<span class="italic">COLNAMES</span>}]<span class="superscript">m</span>[,{<span class="italic">COLBEFOREVALS</span>}]<span class="superscript">m</span>,{<span class="italic">COLVALUES</span>}<span class="superscript">m</span>\n
</pre>
<p>Where:</p>
<ul>
<li>
<p>There can be <span class="italic">n</span> metadata columns each followed by a field delimiter such as the comma shown in the format statement.</p>
</li>
<li>
<p>There can be <span class="italic">m</span> column values. Each of these are preceded by a field delimiter such as a comma.</p>
</li>
<li>
<p>The column name and before value are optional.</p>
</li>
<li>
<p>Each record is terminated by an end of line delimiter, such as <code>\n</code>.</p>
</li>
</ul>
<div id="GADAD165" class="sect2"><a id="sthref155"></a>
<h3 class="sect2"><span class="secnum">10.3.1</span> Metadata Columns</h3>
<p>The metadata columns correspond to the header and contain fields that have special meaning. Metadata columns should include the following information.</p>
<ul>
<li>
<p><span class="bold">optype</span> contains values indicating if the record is an insert, update, or delete. The default values are <code>I</code>, <code>U</code>, and <code>D</code>.</p>
</li>
<li>
<p><span class="bold">timestamp</span> indicates type of value to use for the commit timestamp of the record. The format of the timestamp defaults to <code>YYYY-DD-MM HH:MM:SS.FFF</code>.</p>
</li>
<li>
<p><span class="bold">schemaandtable</span> is the full table name for the record in the format <code>SCHEMA.TABLE</code>.</p>
</li>
<li>
<p><span class="bold">schema</span> is the record's schema name.</p>
</li>
<li>
<p><span class="bold">table</span> is the record's table name.</p>
</li>
<li>
<p><span class="bold">txind</span> is a value that indicates whether the record is the beginning, middle, end or the only record in the transaction. The default values are 0, 1, 2, 3.</p>
</li>
<li>
<p><span class="bold">id</span> is the value used as the sequence number (RSN or CSN) of the record. The id of the first record (operation) in the transaction is used for the sequence number of the transaction.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<div id="GADAD166" class="sect2"><a id="sthref156"></a>
<h3 class="sect2"><span class="secnum">10.3.2</span> Parsing Properties</h3>
<p>Properties can be set to describe delimiters, values, and date and time formats.</p>
<div id="GADAD167" class="sect3"><a id="sthref157"></a>
<h4 class="sect3"><span class="secnum">10.3.2.1</span> Properties to Describe Delimiters</h4>
<p>The following properties determine the parsing rules for delimiting the record.</p>
<ul>
<li>
<p><span class="bold">fielddelim</span> specifies one or more ASCII or hexadecimal characters as the value for the field delimiter</p>
</li>
<li>
<p><span class="bold">recorddelim</span> specifies one or more ASCII or hexadecimal characters as the value for the record delimiter</p>
</li>
<li>
<p><span class="bold">quote</span> specifies one or more ASCII or hexadecimal characters to use for quoted values</p>
</li>
<li>
<p><span class="bold">nullindicator</span> specifies one or more ASCII or hexadecimal characters to use for <code>NULL</code> values</p>
</li>
</ul>
<p>You can define escape characters for the delimiters so they will be replaced if the characters are found in the text. For example if a backslash and apostrophe (\') are specified, then the input "They used Mike\'s truck" is translated to "They used Mike's truck". Or if two quotes ("") are specified, "They call him ""Big Al""" is translated to "They call him "Big Al"".</p>
<p>Data values may be present in the record without quotes, but the system only removes escape characters within quoted values. A non-quoted string that matches a null indicator is treated as null.</p>
</div>
<!-- class="sect3" -->
<div id="GADAD168" class="sect3"><a id="sthref158"></a>
<h4 class="sect3"><span class="secnum">10.3.2.2</span> Properties to Describe Values</h4>
<p>The following properties provide more information:</p>
<ul>
<li>
<p><span class="bold">hasbefores</span> indicates before values are present for each record</p>
</li>
<li>
<p><span class="bold">hasnames</span> indicates column names are present for each record</p>
</li>
<li>
<p><span class="bold">afterfirst</span> indicates column after values come before column before values</p>
</li>
<li>
<p><span class="bold">isgrouped</span> indicates all column names, before values and after values are grouped together in three blocks, rather than alternately per column</p>
</li>
</ul>
</div>
<!-- class="sect3" -->
<div id="GADAD169" class="sect3"><a id="sthref159"></a>
<h4 class="sect3"><span class="secnum">10.3.2.3</span> Properties to Describe Date and Time</h4>
<p>The default format <code>YYYY-DD-MM HH:MM:SS.FFF</code> is used to parse dates. The user can use properties to override this on a global, table or column level. Examples of changing the format are shown below.</p>
<pre>
delim.dateformat.default=MM/DD/YYYY-HH:MM:SS
delim.dateformat.MY.TABLE=DD/MMM/YYYY
delim.dateformat.MY.TABLE.COL1=MMYYYY
</pre></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<div id="GADAD170" class="sect2"><a id="sthref160"></a>
<h3 class="sect2"><span class="secnum">10.3.3</span> Parsing Steps</h3>
<p>The steps in delimited parsing are:</p>
<ol>
<li>
<p>The parser first reads and validates the metadata columns for each record.</p>
</li>
<li>
<p>This provides the table name, which can then be used to look up column definitions for that table in the source definitions file.</p>
</li>
<li>
<p>If a definition cannot be found for a table, the processing will stop.</p>
</li>
<li>
<p>Otherwise the columns are parsed and output to the trail in the order and format defined by the source definitions.</p>
</li>
</ol>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="A1001531"></a>
<div id="GADAD171" class="sect1">
<h2 class="sect1"><span class="secnum">10.4</span> XML Parsing</h2>
<p>XML parsing is based on a preexisting source definitions file and a set of properties. The properties specify rules to determine XML elements and attributes that correspond to transactions, operations and columns. The source definitions file determines the valid tables to be processed and the ordering and data types of columns in those tables.</p>
<div id="GADAD172" class="sect2"><a id="sthref161"></a>
<h3 class="sect2"><span class="secnum">10.4.1</span> Styles of XML</h3>
<p>The XML message is formatted in either dynamic or static XML. At runtime the contents of dynamic XML are data values that cannot be predetermined using a sample XML or XSD document. The contents of static XML that determine tables and column element or attribute names can be predetermined using those sample documents.</p>
<p>The following two examples contain the same data.</p>
<div id="GADAD173" class="example">
<p class="titleinexample"><a id="sthref162"></a>Example 10-5 An Example of Static XML</p>
<pre>
&lt;NewMyTableEntries&gt; 
  &lt;NewMyTableEntry&gt; 
    &lt;CreateTime&gt;2010-02-05:10:11:21&lt;/CreateTime&gt; 
    &lt;KeyCol&gt;keyval&lt;/KeyCol&gt; 
    &lt;Col1&gt;col1val&lt;/Col1&gt;
  &lt;/NewMyTableEntry&gt;
&lt;/NewMyTableEntries&gt;
</pre>
<p>The <code>NewMyTableEntries</code> element marks the transaction boundaries. The <code>NewMyTableEntry</code> indicates an insert to <code>MY.TABLE</code>. The timestamp is present in an element text value, and the column names are indicated by element names.</p>
<p>You can define rules in the properties file to parse either of these two styles of XML through a set of XPath-like properties. The goal of the properties is to map the XML to a predefined source definitions file through XPath matches.</p>
</div>
<!-- class="example" -->
<div id="GADAD174" class="example">
<p class="titleinexample"><a id="sthref163"></a>Example 10-6 An Example of Dynamic XML</p>
<pre>
&lt;transaction id="1234" ts="2010-02-05:10:11:21"&gt;
  &lt;operation table="MY.TABLE" optype="I"&gt;
    &lt;column name="keycol" index="0"&gt;
      &lt;aftervalue&gt;&lt;![CDATA[keyval]]&gt;&lt;/aftervalue&gt;
    &lt;/column&gt;
    &lt;column name="col1" index="1"&gt;
      &lt;aftervalue&gt;&lt;![CDATA[col1val]]&gt;&lt;/aftervalue&gt;
    &lt;/column&gt;
  &lt;/operation&gt; 
&lt;/transaction&gt;
</pre>
<p>Every operation to every table has the same basic message structure consisting of transaction, operation and column elements. The table name, operation type, timestamp, column names, column values, etc. are obtained from attribute or element text values.</p>
</div>
<!-- class="example" --></div>
<!-- class="sect2" -->
<div id="GADAD175" class="sect2"><a id="sthref164"></a>
<h3 class="sect2"><span class="secnum">10.4.2</span> XML Parsing Rules</h3>
<p>Independent of the style of XML, the parsing process needs to determine:</p>
<ul>
<li>
<p>Transaction boundaries</p>
</li>
<li>
<p>Operation entries and metadata including:</p>
<ul>
<li>
<p>Table name</p>
</li>
<li>
<p>Operation type</p>
</li>
<li>
<p>Timestamp</p>
</li>
</ul>
</li>
<li>
<p>Column entries and metadata including:</p>
<ul>
<li>
<p>Either the column name or index; if both are specified the system will check to see if the column with the specified data has the specified name.</p>
</li>
<li>
<p>Column before or after values, sometimes both.</p>
</li>
</ul>
</li>
</ul>
<p>This is done through a set of interrelated rules. For each type of XML message that is to be processed you name a rule that will be used to obtain the required data. For each of these named rules you add properties to:</p>
<ul>
<li>
<p>Specify the rule as a transaction, operation, or column rule type. Rules of any type are required to have a specified name and type.</p>
</li>
<li>
<p>Specify the XPath expression to match to see if the rule is active for the document being processed. This is optional; if not defined the parser will match the node of the parent rule or the whole document if this is the first rule.</p>
</li>
<li>
<p>List detailed rules (<code>subrules</code>) that are to be processed in the order listed. Which <code>subrules</code> are valid is determined by the rule type. <code>Subrules</code> are optional.</p>
</li>
</ul>
<p>In the following example the top-level rule is defined as <code>genericrule</code>. It is a <code>transaction</code> type rule. Its <code>subrules</code> are defined in <code>oprule</code> and they are of the type <code>operation</code>.</p>
<pre>
xmlparser.rules=genericrule
xmlparser.rules.genericrule.type=tx
xmlparser.rules.genericrule.subrules=oprule
xmlparser.rules.oprule.type=op
</pre></div>
<!-- class="sect2" -->
<div id="GADAD176" class="sect2"><a id="sthref165"></a>
<h3 class="sect2"><span class="secnum">10.4.3</span> XPath Expressions</h3>
<p>The XML parser supports a subset of XPath expressions necessary to match elements and extract data. An expression can be used to match a particular element or to extract data.</p>
<p>When doing data extraction most of the path is used to match. The tail of the expression is used for extraction.</p>
<div id="GADAD177" class="sect3"><a id="sthref166"></a>
<h4 class="sect3"><span class="secnum">10.4.3.1</span> Supported Constructs:</h4>
<div class="inftblhruleinformal">
<table class="cellalignment13" title="Supported Constructs" summary="This two column table lists and describes the supported constructs for XPath expressions." dir="ltr">
<thead>
<tr class="cellalignment2">
<th class="cellalignment14" id="r1c1-t3">Supported Constructs</th>
<th class="cellalignment14" id="r1c2-t3">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2">
<td class="cellalignment8" id="r2c1-t3" headers="r1c1-t3">
<pre>
/e
</pre></td>
<td class="cellalignment8" headers="r2c1-t3 r1c2-t3">Use the absolute path from the root of the document to match <code>e</code>.</td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment8" id="r3c1-t3" headers="r1c1-t3">
<pre>
./e or e
</pre></td>
<td class="cellalignment8" headers="r3c1-t3 r1c2-t3">Use the relative path from current node being processed to match <code>e</code>.</td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment8" id="r4c1-t3" headers="r1c1-t3">
<pre>
../e
</pre></td>
<td class="cellalignment8" headers="r4c1-t3 r1c2-t3">Use a path based on the parent of the current node (can be repeated) to match <code>e</code>.</td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment8" id="r5c1-t3" headers="r1c1-t3">
<pre>
//e
</pre></td>
<td class="cellalignment8" headers="r5c1-t3 r1c2-t3">Match <code>e</code> wherever it occurs in a document.</td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment8" id="r6c1-t3" headers="r1c1-t3">
<pre>
*
</pre></td>
<td class="cellalignment8" headers="r6c1-t3 r1c2-t3">Match any element. Note: Partially wild-carded names are not supported.</td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment8" id="r7c1-t3" headers="r1c1-t3">
<pre>
[n]
</pre></td>
<td class="cellalignment8" headers="r7c1-t3 r1c2-t3">Match the nth occurrence of an expression.</td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment8" id="r8c1-t3" headers="r1c1-t3">
<pre>
[x=v]
</pre></td>
<td class="cellalignment8" headers="r8c1-t3 r1c2-t3">Match when x is equal to some value v where x can be:
<ul>
<li>
<p><code>@att</code> &ndash; some attribute value</p>
</li>
<li>
<p><code>text()</code> &ndash; some text value</p>
</li>
<li>
<p><code>name()</code> &ndash; the element name</p>
</li>
<li>
<p><code>position()</code> &ndash; the element position</p>
</li>
</ul>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblhruleinformal" --></div>
<!-- class="sect3" -->
<div id="GADAD178" class="sect3"><a id="sthref167"></a>
<h4 class="sect3"><span class="secnum">10.4.3.2</span> Supported Expressions</h4>
<div class="inftblhruleinformal">
<table class="cellalignment13" title="Supported Expressions" summary="This two column table lists the action and description of supported expressions for XPath expressions." dir="ltr">
<thead>
<tr class="cellalignment2">
<th class="cellalignment14" id="r1c1-t4">Supported Expressions</th>
<th class="cellalignment14" id="r1c2-t4">Descriptions</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2">
<td class="cellalignment8" id="r2c1-t4" headers="r1c1-t4">Match root element</td>
<td class="cellalignment8" headers="r2c1-t4 r1c2-t4">
<pre>
/My/Element 
</pre></td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment8" id="r3c1-t4" headers="r1c1-t4">Match sub element to current node</td>
<td class="cellalignment8" headers="r3c1-t4 r1c2-t4">
<pre>
./Sub/Element 
</pre></td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment8" id="r4c1-t4" headers="r1c1-t4">Match nth element</td>
<td class="cellalignment8" headers="r4c1-t4 r1c2-t4">
<pre>
 /My/*[n] 
</pre></td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment8" id="r5c1-t4" headers="r1c1-t4">Match nth Some element</td>
<td class="cellalignment8" headers="r5c1-t4 r1c2-t4">
<pre>
/My/Some[n] 
</pre></td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment8" id="r6c1-t4" headers="r1c1-t4">Match any text value</td>
<td class="cellalignment8" headers="r6c1-t4 r1c2-t4">
<pre>
/My/*[text() ='value'] 
</pre></td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment8" id="r7c1-t4" headers="r1c1-t4">Match the text in Some element</td>
<td class="cellalignment8" headers="r7c1-t4 r1c2-t4">
<pre>
/My/Some[text() = 'value'] 
</pre></td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment8" id="r8c1-t4" headers="r1c1-t4">Match any attribute</td>
<td class="cellalignment8" headers="r8c1-t4 r1c2-t4">
<pre>
/My/*[@att = 'value'] 
</pre></td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment8" id="r9c1-t4" headers="r1c1-t4">Match the attribute in Some element</td>
<td class="cellalignment8" headers="r9c1-t4 r1c2-t4">
<pre>
/My/Some[@att = 'value'] 
</pre></td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblhruleinformal" --></div>
<!-- class="sect3" -->
<div id="GADAD179" class="sect3"><a id="sthref168"></a>
<h4 class="sect3"><span class="secnum">10.4.3.3</span> Obtaining Data Values</h4>
<p>In addition to matching paths, the XPath expressions can also be used to obtain data values, either absolutely or relative to the current node being processed. Data value expressions can contain any of the path elements above, but must end with one of the value accessors listed below.</p>
<div class="inftblhruleinformal">
<table class="cellalignment13" title="Value Accessors" summary="This two column table lists the name and description of value accessors present in the data value expressions." dir="ltr">
<thead>
<tr class="cellalignment2">
<th class="cellalignment14" id="r1c1-t5">Value Accessors</th>
<th class="cellalignment14" id="r1c2-t5">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2">
<td class="cellalignment8" id="r2c1-t5" headers="r1c1-t5">
<pre>
@att 
</pre></td>
<td class="cellalignment8" headers="r2c1-t5 r1c2-t5">Some attribute value.</td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment8" id="r3c1-t5" headers="r1c1-t5">
<pre>
text() 
</pre></td>
<td class="cellalignment8" headers="r3c1-t5 r1c2-t5">The text content (value) of an element.</td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment8" id="r4c1-t5" headers="r1c1-t5">
<pre>
content() 
</pre></td>
<td class="cellalignment8" headers="r4c1-t5 r1c2-t5">The full content of an element, including any child XML nodes.</td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment8" id="r5c1-t5" headers="r1c1-t5">
<pre>
name() 
</pre></td>
<td class="cellalignment8" headers="r5c1-t5 r1c2-t5">The name of an element.</td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment8" id="r6c1-t5" headers="r1c1-t5">
<pre>
position() 
</pre></td>
<td class="cellalignment8" headers="r6c1-t5 r1c2-t5">The position of an element in its parent.</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblhruleinformal" -->
<div id="GADAD180" class="example">
<p class="titleinexample"><a id="sthref169"></a>Example 10-7 Examples of Extracting Data Values</p>
<p>To extract the relative element text value:</p>
<pre>
/My/Element/text()
</pre>
<p>To extract the absolute attribute value:</p>
<pre>
/My/Element/@att
</pre>
<p>To extract element text value with a match:</p>
<pre>
/My/Some[@att = 'value']/Sub/text()
</pre></div>
<!-- class="example" -->
<div class="infobox-note">
<p class="notep1">Note:</p>
Path accessors, such as ancestor/descendent/self, are not supported.</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<div id="GADAD181" class="sect2"><a id="sthref170"></a>
<h3 class="sect2"><span class="secnum">10.4.4</span> Other Value Expressions</h3>
<p>The values extracted by the XML parser are either column values or properties of the transaction or operation, such as table or timestamp. These values are either obtained from XML using XPath or through properties of the JMS message, system values, or hard coded values. The XML parser properties specify which of these options are valid for obtaining the values for that property.</p>
<p>The following example specifies that <code>timestamp</code> can be an XPath expression, a JMS property, or the system generated timestamp.</p>
<pre>
{<span class="italic">txrule</span>}.timestamp={<span class="italic">xpath-expression</span>}|${<span class="italic">jms-property</span>}|*ts
</pre>
<p>The next example specifies that <code>table</code> can be an XPath expression, a JMS property, or hard coded value.</p>
<pre>
{<span class="italic">oprule</span>}.table={<span class="italic">xpath-expression</span>}|${<span class="italic">jms-property</span>}|"value"
</pre>
<p>The last example specifies that <code>name</code> can be a XPath expression or hard coded value.</p>
<pre>
{<span class="italic">colrule</span>}.timestamp={<span class="italic">xpath-expression</span>}|"value"
</pre></div>
<!-- class="sect2" -->
<div id="GADAD182" class="sect2"><a id="sthref171"></a>
<h3 class="sect2"><span class="secnum">10.4.5</span> Transaction Rules</h3>
<p>The rule that specifies the boundary for a transaction is at the highest level. Messages may contain a single transaction, multiple transactions, or a part of a transaction that spans messages. These are specified as follows:</p>
<ul>
<li>
<p><span class="bold">single</span> - The transaction rule match is not defined.</p>
</li>
<li>
<p><span class="bold">multiple</span> - Each transaction rule match defines new transaction.</p>
</li>
<li>
<p><span class="bold">span</span> &ndash; No transaction rule is defined; instead a transaction indicator is specified in an operation rule.</p>
</li>
</ul>
<p>For a transaction rule, the following properties of the rule may also be defined through XPath or other expressions:</p>
<ul>
<li>
<p><span class="bold">timestamp</span> &ndash; The time at which the transaction occurred.</p>
</li>
<li>
<p><span class="bold">txid</span> &ndash; The identifier for the transaction.</p>
</li>
</ul>
<p>Transaction rules can have multiple <code>subrules</code>, but each must be of type operation.</p>
<p>The following example specifies a transaction that is the whole message and includes a timestamp that comes from the JMS property.</p>
<div id="GADAD183" class="example">
<p class="titleinexample"><a id="sthref172"></a>Example 10-8 JMS Timestamp</p>
<pre>
singletxrule.timestamp=$JMSTimeStamp
</pre>
<p>The following example matches the root element transaction and obtains the timestamp from the <code>ts</code> attribute.</p>
</div>
<!-- class="example" -->
<div id="GADAD184" class="example">
<p class="titleinexample"><a id="sthref173"></a>Example 10-9 ts Timestamp</p>
<pre>
dyntxrule.match=/Transaction
dyntxrule.timestamp=@ts
</pre></div>
<!-- class="example" --></div>
<!-- class="sect2" -->
<div id="GADAD185" class="sect2"><a id="sthref174"></a>
<h3 class="sect2"><span class="secnum">10.4.6</span> Operation Rules</h3>
<p>An operation rule can either be a subrule of a transaction rule, or a highest level rule (if the transaction is a property of the operation).</p>
<p>In addition to the standard rule properties, an operation rule should also define the following through XPath or other expressions:</p>
<ul>
<li>
<p><span class="bold">timestamp</span> &ndash; The timestamp of the operation. This is optional if the transaction rule is defined.</p>
</li>
<li>
<p><span class="bold">table</span> &ndash; The name of the table on which this is an operation. Use this with schema.</p>
</li>
<li>
<p><span class="bold">schema</span> &ndash; The name of schema for the table.</p>
</li>
<li>
<p><span class="bold">schemaandtable</span> &ndash; Both schema and table name together in the form <code>SCHEMA.TABLE</code>. This can be used in place of the individual table and schema properties.</p>
</li>
<li>
<p><span class="bold">optype</span> &ndash; Specifies whether this is an insert, update or delete operation based on <code>optype</code> values:</p>
<ul>
<li>
<p><span class="bold">optype.insertval</span> &ndash; The value indicating an insert. The default is <code>I</code>.</p>
</li>
<li>
<p><span class="bold">optype.updateval</span> &ndash; The value indicating an update. The default is <code>U</code>.</p>
</li>
<li>
<p><span class="bold">optype.deleteval</span> &ndash; The value indicating a delete. The default is <code>D</code>.</p>
</li>
</ul>
</li>
<li>
<p><span class="bold">seqid</span> &ndash; The identifier for the operation. This will be the transaction identifier if <code>txid</code> has not already been defined at the transaction level.</p>
</li>
<li>
<p><span class="bold">txind</span> &ndash; Specifies whether this operation is the beginning of a transaction, in the middle or at the end; or if it is the whole operation. This property is optional and not valid if the operation rule is a subrule of a transaction rule.</p>
</li>
</ul>
<p>Operation rules can have multiple subrules of type operation or column.</p>
<p>The following example dynamically obtains operation information from the <code>/Operation</code> element of a <code>/Transaction</code>.</p>
<div id="GADAD186" class="example">
<p class="titleinexample"><a id="sthref175"></a>Example 10-10 Operation</p>
<pre>
dynoprule.match=./Operation
dynoprule.schemaandtable=@table
dynoprule.optype=@type
</pre>
<p>The following example statically matches <code>/NewMyTableEntry</code> element to an insert operation on the <code>MY.TABLE</code> table.</p>
</div>
<!-- class="example" -->
<div id="GADAD187" class="example">
<p class="titleinexample"><a id="sthref176"></a>Example 10-11 Operation example</p>
<pre>
statoprule.match=./NewMyTableEntry
statoprule.schemaandtable="MY.TABLE"
statoprule.optype="I"
statoprule.timestamp=./CreateTime/text()
</pre></div>
<!-- class="example" --></div>
<!-- class="sect2" -->
<div id="GADAD188" class="sect2"><a id="sthref177"></a>
<h3 class="sect2"><span class="secnum">10.4.7</span> Column Rules</h3>
<p>A column rule must be a subrule of an operation rule. In addition to the standard rule properties, a column rule should also define the following through XPath or other expressions.</p>
<ul>
<li>
<p><span class="bold">name</span> &ndash; The name of the column within the table definition.</p>
</li>
<li>
<p><span class="bold">index</span> &ndash; The index of the column within the table definition.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
If only one of <code>name</code> and <code>index</code> is defined, the other will be determined.</div>
</li>
<li>
<p><span class="bold">before.value</span> &ndash; The before value of the column. This is required for deletes, but is optional for updates.</p>
</li>
<li>
<p><span class="bold">before.isnull</span> &ndash; Indicates whether the before value of the column is null.</p>
</li>
<li>
<p><span class="bold">before.ismissing</span> &ndash; Indicates whether the before value of the column is missing.</p>
</li>
<li>
<p><span class="bold">after.value</span> &ndash; The before value of the column. This is required for deletes, but is optional for updates.</p>
</li>
<li>
<p><span class="bold">after.isnull</span> &ndash; Indicates whether the before value of the column is null.</p>
</li>
<li>
<p><span class="bold">after.ismissing</span> &ndash; Indicates whether the before value of the column is missing.</p>
</li>
<li>
<p><span class="bold">value</span> &ndash; An expression to use for both <code>before.value</code> and <code>after.value</code> unless overridden by specific before or after values. Note that this does not support different before values for updates.</p>
</li>
<li>
<p><span class="bold">isnull</span> &ndash; An expression to use for both before.isnull and after.isnull unless overridden.</p>
</li>
<li>
<p><span class="bold">ismissing</span> &ndash; An expression to use for both before.ismissing and after.ismissing unless overridden.</p>
</li>
</ul>
<p>The following example dynamically obtains column information from the <code>/Column</code> element of an <code>/Operation</code></p>
<div id="GADAD189" class="example">
<p class="titleinexample"><a id="sthref178"></a>Example 10-12 Dynamic Extraction of Column Information</p>
<pre>
dyncolrule.match=./Column
dyncolrule.name=@name
dyncolrule.before.value=./beforevalue/text()
dyncolrule.after.value=./aftervalue/text()
</pre>
<p>The following example statically matches the <code>/KeyCol</code> and <code>/Col1</code> elements to columns in <code>MY.TABLE</code>.</p>
</div>
<!-- class="example" -->
<div id="GADAD190" class="example">
<p class="titleinexample"><a id="sthref179"></a>Example 10-13 Static Matching of Elements to Columns</p>
<pre>
statkeycolrule.match=/KeyCol
statkeycolrule.name="keycol"
statkeycolrule.value=./text()
statcol1rule.match=/Col1
statcol1rule.name="col1"
statcol1rule.value=./text()
</pre></div>
<!-- class="example" --></div>
<!-- class="sect2" -->
<div id="GADAD191" class="sect2"><a id="sthref180"></a>
<h3 class="sect2"><span class="secnum">10.4.8</span> Overall Rules Example</h3>
<p>The following example uses the XML samples shown earlier with appropriate rules to generate the same resulting operation on the <code>MY.TABLE</code> table.</p>
<div class="inftblhruleinformal">
<table class="cellalignment13" title="Example Dynamic XML and Static XML" summary="This table lists the Dynamic and Static XML for the previous examples." dir="ltr">
<thead>
<tr class="cellalignment2">
<th class="cellalignment14" id="r1c1-t8">Dynamic XML</th>
<th class="cellalignment14" id="r1c2-t8">Static XML</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2">
<td class="cellalignment8" id="r2c1-t8" headers="r1c1-t8">
<pre>
&lt;transaction id="1234"
    ts="2010-02-05:10:11:21"&gt;
  &lt;operation table="MY.TABLE" optype="I"&gt;
    &lt;column name="keycol" index="0"&gt;
      &lt;aftervalue&gt;
&lt;![CDATA[keyval]]&gt;
      &lt;/aftervalue&gt;
    &lt;/column&gt;
    &lt;column name="col1" index="1"&gt;
      &lt;aftervalue&gt;
         &lt;![CDATA[col1val]]&gt;
      &lt;/aftervalue&gt;
    &lt;/column&gt;
  &lt;/operation&gt;
&lt;/transaction&gt;
</pre></td>
<td class="cellalignment8" headers="r2c1-t8 r1c2-t8">
<pre>
NewMyTableEntries&gt;
  &lt;NewMyTableEntry&gt;
    &lt;CreateTime&gt;
       2010-02-05:10:11:21
    &lt;/CreateTime&gt;
    &lt;KeyCol&gt;keyval&lt;/KeyCol&gt;
    &lt;Col1&gt;col1val&lt;/Col1&gt;
  &lt;/NewMyTableEntry&gt;
&lt;/NewMyTableEntries&gt;
</pre></td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblhruleinformal" -->
<div class="inftblhruleinformalwide">
<table class="cellalignment13" title="Example Dynamic and Static Rules" summary="This table lists the Dynamic and Static XML rules for the previous examples." dir="ltr">
<thead>
<tr class="cellalignment2">
<th class="cellalignment14" id="r1c1-t9">Dynamic</th>
<th class="cellalignment14" id="r1c2-t9">Static</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment2">
<td class="cellalignment8" id="r2c1-t9" headers="r1c1-t9">
<pre>
dyntxrule.match=/Transaction
dyntxrule.timestamp=@ts 
dyntxrule.subrules=dynoprule 
dynoprule.match=./Operation 
dynoprule.schemaandtable=@table
dynoprule.optype=@type 
dynoprule.subrules=dyncolrule
dyncolrule.match=./Column 
dyncolrule.name=@name 
</pre></td>
<td class="cellalignment8" headers="r2c1-t9 r1c2-t9">
<pre>
stattxrule.match=/NewMyTableEntries
stattxrule.subrules= statoprule 
statoprule.match=./NewMyTableEntry 
statoprule.schemaandtable="MY.TABLE"
statoprule.optype="I" 
statoprule.timestamp=./CreateTime/text()
statoprule.subrules= statkeycolrule,
statcol1rule
statkeycolrule.match=/KeyCol 
</pre></td>
</tr>
<tr class="cellalignment2">
<td class="cellalignment8" id="r3c1-t9" headers="r1c1-t9">
<pre>
dyncolrule.before.value=./beforevalue/text()
dyncolrule.after.value=./aftervalue/text()
</pre></td>
<td class="cellalignment8" headers="r3c1-t9 r1c2-t9">
<pre>
statkeycolrule.name="keycol"
statkeycolrule.value=./text() 
statcol1rule.match=/Col1 
statcol1rule.name="col1"
statcol1rule.value=./text() 
</pre></td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblhruleinformalwide" -->
<pre>
INSERT INTO MY.TABLE (KEYCOL, COL1)
VALUES ('keyval', 'col1val')
</pre></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="A1005173"></a>
<div id="GADAD192" class="sect1">
<h2 class="sect1"><span class="secnum">10.5</span> Source definitions Generation Utility</h2>
<p>Oracle GoldenGate for Java includes a Gendef utility that generates an Oracle GoldenGate source definitions file from the properties defined in a properties file. It creates a normalized definition of tables based on the property settings and other parser-specific data definition values.</p>
<p>The syntax to run this utility is:</p>
<pre>
gendef &ndash;prop {<span class="italic">property_file</span>} [-out {<span class="italic">output_file</span>}
</pre>
<p>This defaults to sending the source definitions to standard out, but it can be directed to a file using the <code>&ndash;out</code> parameter. For example:</p>
<pre>
gendef &ndash;prop dirprm/jmsvam.properties -out dirdef/msgdefs.def
</pre>
<p>The output source definitions file can then be used in a pump or delivery process to interpret the trail data created through the VAM.</p>
</div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment1">
<tr>
<td class="cellalignment8">
<table class="cellalignment6">
<tr>
<td class="cellalignment5"><a href="java_msgcap_config.htm"><img width="24" height="24" src="../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>
<td class="cellalignment5"><a href="java_msgcap_properties.htm"><img width="24" height="24" src="../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table>
</td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment10">
<table class="cellalignment4">
<tr>
<td class="cellalignment5"><a href="../../index.htm"><img width="24" height="24" src="../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment5"><a href="toc.htm"><img width="24" height="24" src="../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment5"><a href="../dcommon/html/feedback.htm"><img width="24" height="24" src="../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
