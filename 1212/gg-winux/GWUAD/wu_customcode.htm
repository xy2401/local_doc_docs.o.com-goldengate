<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml/DTD/xhtml1-transitional.dtd">
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>17 Customizing Oracle GoldenGate Processing</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1028" />
<meta name="description" content="This chapter describes how to customize Oracle GoldenGate processing." />
<meta name="dcterms.created" content="2014-11-11T22:58:6Z" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Oracle&reg; GoldenGate Administering Oracle GoldenGate for Windows and UNIX" />
<meta name="dcterms.identifier" content="E29388-06" />
<meta name="dcterms.isVersionOf" content="GWUAD" />
<link rel="Start" href="../../index.html" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Index" href="index.htm" title="Index" type="text/html" />
<link rel="Prev" href="wu_initsync.htm" title="Previous" type="text/html" />
<link rel="Next" href="wu_monitoring.htm" title="Next" type="text/html" />
<link rel="alternate" href="../GWUAD.pdf" title="PDF version" type="application/pdf" />
<link rel="alternate" href="../GWUAD.epub" title="ePub version" type="application/epub+zip" />
<link rel="alternate" href="../GWUAD.mobi" title="Mobipocket version" type="application/x-mobipocket-ebook" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
<script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script></head>
<body>
<header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Skip Headers</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns"><div id="BREADCRUMBS"><a href="http://docs.oracle.com">Home</a> / <a href="../../index.html">Middleware</a> / <a href="../index.html">Oracle GoldenGate for Windows and UNIX</a>
</div>

<span id="PAGE" style="display:none;">20/30</span>
<!-- End Header -->
<div id="GWUAD571" class="chapter"><a id="i1051801"></a>
<h1 class="chapter"><span class="secnum">17</span> Customizing Oracle GoldenGate Processing</h1>
<p><a id="GWUAD572"></a>This chapter describes how to customize Oracle GoldenGate processing.</p>
<p>This chapter includes the following sections:</p>
<ul>
<li>
<p><a href="#i1047721">Executing Commands, Stored Procedures, and Queries with SQLEXEC</a></p>
</li>
<li>
<p><a href="#i1048675">Using Oracle GoldenGate Macros to Simplify and Automate Work</a></p>
</li>
<li>
<p><a href="#i1012304">Using User Exits to Extend Oracle GoldenGate Capabilities</a></p>
</li>
<li>
<p><a href="#i1047744">Using the Oracle GoldenGate Event Marker System to Raise Database Events</a></p>
</li>
</ul>
<a id="i1047721"></a>
<div id="GWUAD574" class="sect1">
<h2 class="sect1"><span class="secnum">17.1</span> Executing Commands, <a id="sthref877"></a><a id="sthref878"></a>Stored Procedures, and <a id="sthref879"></a>Queries with SQLEXEC</h2>
<p>The <code dir="ltr">SQLEXEC</code> parameter of Oracle GoldenGate enables Extract and Replicat to communicate with the database to do the following:</p>
<ul>
<li>
<p>Execute a <a id="sthref880"></a><a id="sthref881"></a>database command, stored procedure, or SQL query to perform a database function, return results (<code dir="ltr">SELECT</code> statements) or perform DML (<code dir="ltr">INSERT</code>, <code dir="ltr">UPDATE</code>, <code dir="ltr">DELETE</code>) operations.</p>
</li>
<li>
<p>Retrieve output parameters from a procedure for input to a <code dir="ltr"><a id="sthref882"></a>FILTER</code> or <code dir="ltr"><a id="sthref883"></a>COLMAP</code> clause.</p>
</li>
</ul>
<div id="GWUAD575" class="sect2"><a id="sthref884"></a>
<h3 class="sect2"><span class="secnum">17.1.1</span> Performing Processing with SQLEXEC</h3>
<p><code dir="ltr">SQLEXEC</code> extends the functionality of both Oracle GoldenGate and the database by allowing Oracle GoldenGate to use the native SQL of the database to execute custom processing instructions.</p>
<ul>
<li>
<p>Stored procedures and queries can be used to <a id="sthref885"></a><a id="sthref886"></a>select or insert data into the database, to aggregate data, to denormalize or normalize data, or to perform any other function that requires database operations as input. Oracle GoldenGate supports stored procedures that accept input and those that produce output.</p>
</li>
<li>
<p>Database commands can be issued to perform database functions required to facilitate Oracle GoldenGate processing, such as disabling triggers on target tables and then enabling them again.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<div id="GWUAD576" class="sect2"><a id="sthref887"></a>
<h3 class="sect2"><span class="secnum">17.1.2</span> Using SQLEXEC</h3>
<p>The <code dir="ltr"><a id="sthref888"></a>SQLEXEC</code> parameter can be used as follows:</p>
<ul>
<li>
<p>as a clause of a <code dir="ltr">TABLE</code> or <code dir="ltr">MAP</code> statement</p>
</li>
<li>
<p>as a standalone parameter at the root level of the Extract or Replicat parameter file.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<div id="GWUAD577" class="sect2"><a id="sthref889"></a>
<h3 class="sect2"><span class="secnum">17.1.3</span> Executing SQLEXEC within a TABLE or MAP Statement</h3>
<p>When used within a <code dir="ltr">TABLE</code> or <code dir="ltr">MAP</code> statement, <code dir="ltr">SQLEXEC</code> can pass and accept parameters. It can be used for procedures and queries, but not for database commands.</p>
<p class="subhead2"><a id="GWUAD578"></a>Syntax</p>
<p>This syntax executes a procedure within a <code dir="ltr">TABLE</code> or <code dir="ltr">MAP</code> statement.</p>
<pre dir="ltr">
SQLEXEC (SPNAME <span class="codeinlineitalic">sp_name</span>,
[<a id="sthref890"></a>ID <span class="codeinlineitalic">logical_name</span>,]
{<a id="sthref891"></a>PARAMS <span class="codeinlineitalic">param_spec</span> | <a id="sthref892"></a>NOPARAMS})
</pre>
<div class="inftblhruleinformal">
<table class="cellalignment160" title="Arguments For Executing SQLEXEC Procedure Within a TABLE or MAP Statement" summary="This table describes the arguments for executing a SQLEXEC procedure within a TABLE or MAP statement.">
<thead>
<tr class="cellalignment151">
<th class="cellalignment161" id="r1c1-t2">Argument</th>
<th class="cellalignment161" id="r1c2-t2">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment151">
<td class="cellalignment157" id="r2c1-t2" headers="r1c1-t2">
<pre dir="ltr">
SPNAME
</pre></td>
<td class="cellalignment157" headers="r2c1-t2 r1c2-t2">Required keyword that begins a clause to execute a stored procedure.</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r3c1-t2" headers="r1c1-t2">
<pre dir="ltr">
<span class="codeinlineitalic">sp_name</span>
</pre></td>
<td class="cellalignment157" headers="r3c1-t2 r1c2-t2">Specifies the name of the stored procedure to execute.
<p>For Informix, the stored procedure should be specified as a three-part name. For example, <code dir="ltr">mydatabase.myschema.myproc</code>.</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r4c1-t2" headers="r1c1-t2">
<pre dir="ltr">
ID <span class="codeinlineitalic">logical_name</span>
</pre></td>
<td class="cellalignment157" headers="r4c1-t2 r1c2-t2">Defines a logical name for the procedure. Use this option to execute the procedure multiple times within a <code dir="ltr">TABLE</code> or <code dir="ltr">MAP</code> statement. Not required when executing a procedure only once.</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r5c1-t2" headers="r1c1-t2">
<pre dir="ltr">
PARAMS <span class="codeinlineitalic">param_spec</span> |
NOPARAMS
</pre></td>
<td class="cellalignment157" headers="r5c1-t2 r1c2-t2">Specifies whether or not the procedure accepts <a id="sthref893"></a>parameters. One of these options must be used (see <a href="#i1000176">Section 17.1.5, "Using Input and Output Parameters"</a>).</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblhruleinformal" -->
<p class="subhead2"><a id="GWUAD579"></a>Syntax</p>
<p>This syntax executes a query within a <code dir="ltr">TABLE</code> or <code dir="ltr">MAP</code> statement.</p>
<pre dir="ltr">
SQLEXEC (ID <span class="codeinlineitalic">logical_name</span>, QUERY ' <span class="codeinlineitalic">query</span> ',
{PARAMS <span class="codeinlineitalic">param_spec</span> | NOPARAMS})
</pre>
<div class="inftblhruleinformal">
<table class="cellalignment160" title="Arguments For Executing SQLEXEC Query Within a TABLE or MAP Statement." summary="This table describes the arguments for executing a SQLEXEC query within a TABLE or MAP statement.">
<thead>
<tr class="cellalignment151">
<th class="cellalignment161" id="r1c1-t3">Argument</th>
<th class="cellalignment161" id="r1c2-t3">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment151">
<td class="cellalignment157" id="r2c1-t3" headers="r1c1-t3">
<pre dir="ltr">
ID <span class="codeinlineitalic">logical_name</span>
</pre></td>
<td class="cellalignment157" headers="r2c1-t3 r1c2-t3">Defines a logical name for the query. A logical name is required in order to extract values from the query results. <code dir="ltr">ID</code> <code dir="ltr"><span class="codeinlineitalic">logical_name</span></code> references the column values returned by the query.</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r3c1-t3" headers="r1c1-t3">
<pre dir="ltr">
QUERY<a id="sthref894"></a> ' <span class="codeinlineitalic">sql_query</span> '
</pre></td>
<td class="cellalignment157" headers="r3c1-t3 r1c2-t3">Specifies the SQL query syntax to execute against the database. It can either return results with a <code dir="ltr">SELECT</code> statement or change the database with an <code dir="ltr">INSERT</code>, <code dir="ltr">UPDATE</code>, or <code dir="ltr">DELETE</code> statement. The query must be within single quotes and must be contained all on one line. Specify case-sensitive object names the way they are stored in the database, such as within quotes for Oracle case-sensitive names.
<pre dir="ltr">
SQLEXEC 'SELECT "col1" from "schema"."table"'
</pre></td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r4c1-t3" headers="r1c1-t3">
<pre dir="ltr">
PARAMS <span class="codeinlineitalic">param_spec</span> |
NOPARAMS
</pre></td>
<td class="cellalignment157" headers="r4c1-t3 r1c2-t3">Defines whether or not the query accepts parameters. One of these options must be used (see <a href="#i1000176">Section 17.1.5, "Using Input and Output Parameters"</a>).</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblhruleinformal" -->
<p>If you want to execute a query on a table residing on a different database than the current database, then the different database name has to be specified with the table. The delimiter between the database name and the tablename should be a colon (<code dir="ltr">:</code>). The following are some example use cases:</p>
<pre dir="ltr">
select col1 from db1:tab1
select col2 from db2:schema2.tab2
select col3 from tab3
select col3 from schema4.tab4
</pre></div>
<!-- class="sect2" -->
<div id="GWUAD580" class="sect2"><a id="sthref895"></a>
<h3 class="sect2"><span class="secnum">17.1.4</span> Executing SQLEXEC as a Standalone Statement</h3>
<p>When used as a standalone parameter statement in the Extract or Replicat parameter file, <code dir="ltr">SQLEXEC</code> can execute a stored procedure, query, or database command. As such, it need not be tied to any specific table and can be used to perform general SQL operations. For example, if the Oracle GoldenGate database user account is configured to time-out when idle, you could use <code dir="ltr">SQLEXEC</code> to execute a query at a defined interval, so that Oracle GoldenGate does not appear idle. As another example, you could use <code dir="ltr">SQLEXEC</code> to issue an essential database command, such as to disable target triggers. A standalone <code dir="ltr">SQLEXEC</code> statement cannot accept input parameters or return output parameters.</p>
<div class="inftblhruleinformal">
<table class="cellalignment160" title="SQLEXEC Parameter Syntax" summary="This table shows parameter syntax for executing SQLEXEC as a standalone statement.">
<thead>
<tr class="cellalignment151">
<th class="cellalignment161" id="r1c1-t4">Parameter syntax</th>
<th class="cellalignment161" id="r1c2-t4">Purpose</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment151">
<td class="cellalignment157" id="r2c1-t4" headers="r1c1-t4">
<pre dir="ltr">
SQLEXEC 'call<span class="codeinlineitalic"> procedure_name</span>()'
</pre></td>
<td class="cellalignment157" headers="r2c1-t4 r1c2-t4">Execute a stored procedure</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r3c1-t4" headers="r1c1-t4">
<pre dir="ltr">
SQLEXEC '<span class="codeinlineitalic">sql_query</span>'
</pre></td>
<td class="cellalignment157" headers="r3c1-t4 r1c2-t4">Execute a query</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r4c1-t4" headers="r1c1-t4">
<pre dir="ltr">
SQLEXEC '<span class="codeinlineitalic">database_command</span>'
</pre></td>
<td class="cellalignment157" headers="r4c1-t4 r1c2-t4">Execute a database command</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblhruleinformal" -->
<div class="inftblhruleinformal">
<table class="cellalignment160" title="Arguments For Executing SQLEXEC as a Standalone Statement" summary="This table describes the arguments for executing SQLEXEC as a standalone statement.">
<thead>
<tr class="cellalignment151">
<th class="cellalignment161" id="r1c1-t5">Argument</th>
<th class="cellalignment161" id="r1c2-t5">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment151">
<td class="cellalignment157" id="r2c1-t5" headers="r1c1-t5">
<pre dir="ltr">
'call
<span class="codeinlineitalic">procedure_name</span> ()'
</pre></td>
<td class="cellalignment157" headers="r2c1-t5 r1c2-t5">Specifies the name of a stored procedure to execute. The statement must be enclosed within single quotes.
<p>Example:</p>
<pre dir="ltr">
SQLEXEC 'call prc_job_count ()'
</pre></td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r3c1-t5" headers="r1c1-t5">
<pre dir="ltr">
'<span class="codeinlineitalic">sql_query</span>'
</pre></td>
<td class="cellalignment157" headers="r3c1-t5 r1c2-t5">Specifies the name of a query to execute. The query must be contained all on one line and enclosed within single quotes.
<p>Specify case-sensitive object names the way they are stored in the database, such as within double quotes for Oracle object names that are case-sensitive.</p>
<pre dir="ltr">
SQLEXEC 'SELECT "col1" from "schema"."table"'
</pre></td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r4c1-t5" headers="r1c1-t5">
<pre dir="ltr">
'<span class="codeinlineitalic">database_command</span>'
</pre></td>
<td class="cellalignment157" headers="r4c1-t5 r1c2-t5">Specifies a database command to execute. Must be a valid command for the database.</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="inftblhruleinformal" -->
<p><code dir="ltr">SQLEXEC</code> provides options to control processing behavior, memory usage, and error handling. For more information, see <a class="olink GWURF660" href="../../gg-winux/GWURF/gg_parameters156.htm#GWURF660"><span class="italic">Reference for Oracle GoldenGate for Windows and UNIX</span></a>.</p>
</div>
<!-- class="sect2" -->
<a id="i1000176"></a>
<div id="GWUAD581" class="sect2">
<h3 class="sect2"><span class="secnum">17.1.5</span> Using Input and Output Parameters</h3>
<p>Oracle GoldenGate provides options for passing input and output values to and from a procedure or query that is executed with <code dir="ltr">SQLEXEC</code> within a <code dir="ltr">TABLE</code> or <code dir="ltr">MAP</code> statement.</p>
<div id="GWUAD1119" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref896"></a>
<h4 class="sect3"><span class="secnum">17.1.5.1</span> Passing Values to Input Parameters</h4>
<p>To pass data values to input parameters within a stored procedure or query, use the <code dir="ltr">PARAMS</code> option of <code dir="ltr">SQLEXEC</code>.</p>
<p class="subhead2"><a id="GWUAD582"></a>Syntax</p>
<pre dir="ltr">
PARAMS ([OPTIONAL | REQUIRED] <span class="codeinlineitalic">param</span> = {<span class="codeinlineitalic">source_column</span> | <span class="codeinlineitalic">function</span>}
[, ...] )
</pre>
<p>Where:</p>
<ul>
<li>
<p><code dir="ltr">OPTIONAL</code> indicates that a parameter value is not required for the SQL to execute. If a required source column is missing from the database operation, or if a column-conversion function cannot complete successfully because a source column is missing, the SQL executes anyway.</p>
</li>
<li>
<p><code dir="ltr">REQUIRED</code> indicates that a parameter value must be present. If the parameter value is not present, the SQL will not be executed.</p>
</li>
<li>
<p><code dir="ltr"><span class="codeinlineitalic">param</span></code> is one of the following:</p>
<ul>
<li>
<p>For a stored procedure, it is the name of any parameter in the procedure that can accept input, such as a column in a lookup table.</p>
</li>
<li>
<p>For an Oracle query, it is the name of any input parameter in the query excluding the leading colon. For example, <code dir="ltr">:param1</code> would be specified as <code dir="ltr">param1</code> in the <code dir="ltr">PARAMS</code> clause.</p>
</li>
<li>
<p>For a non-Oracle query, it is <code dir="ltr">p</code><code dir="ltr"><span class="codeinlineitalic">n</span></code>, where <code dir="ltr"><span class="codeinlineitalic">n</span></code> is the number of the parameter within the statement, starting from 1. For example, in a query with two parameters, the <code dir="ltr"><span class="codeinlineitalic">param</span></code> entries are <code dir="ltr">p1</code> and <code dir="ltr">p2</code>.</p>
</li>
</ul>
</li>
<li>
<p><code dir="ltr">{</code><code dir="ltr"><span class="codeinlineitalic">source_column</span></code> | <code dir="ltr"><span class="codeinlineitalic">function</span></code>} is the column or Oracle GoldenGate conversion function that provides input to the procedure.</p>
</li>
</ul>
</div>
<!-- class="sect3" -->
<div id="GWUAD1120" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref897"></a>
<h4 class="sect3"><span class="secnum">17.1.5.2</span> Passing Values to Output Parameters</h4>
<p>To pass values from a stored procedure or query as input to a <code dir="ltr">FILTER</code> or <code dir="ltr">COLMAP</code> clause, use the following syntax:</p>
<p class="subhead2"><a id="GWUAD583"></a>Syntax</p>
<pre dir="ltr">
{<span class="codeinlineitalic">procedure_name</span> | <span class="codeinlineitalic">logical_name</span>}.<span class="codeinlineitalic">parameter</span>
</pre>
<p>Where:</p>
<ul>
<li>
<p><code dir="ltr"><span class="codeinlineitalic">procedure_name</span></code> is the actual name of the stored procedure. Use this argument only if executing a procedure one time during the life of the current Oracle GoldenGate process.</p>
</li>
<li>
<p><code dir="ltr"><span class="codeinlineitalic">logical_name</span></code> is the logical name specified with the <code dir="ltr">ID</code> option of <code dir="ltr">SQLEXEC</code>. Use this argument if executing a query or a stored procedure that will be executed multiple times.</p>
</li>
<li>
<p><code dir="ltr"><span class="codeinlineitalic">parameter</span></code> is either the name of the parameter or <code dir="ltr">RETURN_VALUE</code>, if extracting returned values.</p>
</li>
</ul>
</div>
<!-- class="sect3" -->
<div id="GWUAD1121" class="sect3"><!-- infolevel="all" infotype="General" --><a id="sthref898"></a>
<h4 class="sect3"><span class="secnum">17.1.5.3</span> SQLEXEC Examples Using Parameters</h4>
<p>These examples use stored procedures and queries with input and output parameters.</p>
<div id="GWUAD584" class="example"><p class="titleinexample"><a id="sthref899"></a>Example 17-1 SQLEXEC with a Stored Procedure</p>
<p>This example uses <code dir="ltr">SQLEXEC</code> to run a stored procedure named <code dir="ltr">LOOKUP</code> that performs a query to return a description based on a code. It then maps the results to a target column named <code dir="ltr">NEWACCT_VAL</code>.</p>
<pre dir="ltr">
CREATE OR REPLACE PROCEDURE LOOKUP
(CODE_PARAM IN VARCHAR2, DESC_PARAM OUT VARCHAR2)
BEGIN
    SELECT DESC_COL
    INTO DESC_PARAM
    FROM LOOKUP_TABLE
    WHERE CODE_COL = CODE_PARAM
END;
</pre>
<p>Contents of <code dir="ltr">MAP</code> statement:</p>
<pre dir="ltr">
MAP sales.account, TARGET sales.newacct, &amp;
  SQLEXEC (SPNAME lookup, PARAMS (code_param = account_code)), &amp;
    COLMAP (newacct_id = account_id, newacct_val = lookup.desc_param);
</pre>
<pre dir="ltr">
</pre>
<p><code dir="ltr">SQLEXEC</code> executes the <code dir="ltr">LOOKUP</code> stored procedure. Within the <code dir="ltr">SQLEXEC</code> clause, the <code dir="ltr">PARAMS (code_param = account_code)</code> statement identifies <code dir="ltr">code_param</code> as the procedure parameter to accept input from the <code dir="ltr">account_code</code> column in the <code dir="ltr">account</code> table.</p>
<p>Replicat executes the <code dir="ltr">LOOKUP</code> stored procedure prior to executing the column map, so that the <code dir="ltr">COLMAP</code> clause can extract and map the results to the <code dir="ltr">newacct_val</code> column.</p>
</div>
<!-- class="example" -->
<div id="GWUAD585" class="example"><p class="titleinexample"><a id="sthref900"></a>Example 17-2 SQLEXEC with a Query</p>
<p>This example implements the same logic as used in the previous example, but it executes a SQL query instead of a stored procedure and uses the <code dir="ltr">@GETVAL</code> function in the column map.</p>
<p>A query must be on one line. To split an Oracle GoldenGate parameter statement into multiple lines, an ampersand (<code dir="ltr">&amp;</code>) line terminator is required.</p>
<p>Query for an Oracle database:</p>
<pre dir="ltr">
MAP sales.account, TARGET sales.newacct, &amp;
SQLEXEC (ID lookup, &amp;
QUERY 'select desc_col desc_param from lookup_table where code_col = :code_param', &amp;
PARAMS (code_param = account_code)), &amp;
COLMAP (newacct_id = account_id, newacct_val = &amp;
@getval (lookup.desc_param));
</pre>
<p>Query for a non-Oracle database:</p>
<pre dir="ltr">
MAP sales.account, TARGET sales.newacct, &amp;
SQLEXEC (ID lookup, &amp;
QUERY 'select desc_col desc_param from lookup_table where code_col = ?', &amp;
PARAMS (p1 = account_code)), &amp;
COLMAP (newacct_id = account_id, newacct_val = &amp;
@getval (lookup.desc_param));
</pre></div>
<!-- class="example" -->
<div class="infobox-note">
<p class="notep1">Note:</p>
Additional <code dir="ltr">SQLEXEC</code> options are available for use when a procedure or query includes parametes. See the full <code dir="ltr">SQLEXEC</code> documentation in <a class="olink GWURF660" href="../../gg-winux/GWURF/gg_parameters156.htm#GWURF660"><span class="italic">Reference for Oracle GoldenGate for Windows and UNIX</span></a>.</div>
</div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<div id="GWUAD1122" class="sect2"><a id="sthref901"></a>
<h3 class="sect2"><span class="secnum">17.1.6</span> Handling SQLEXEC Errors</h3>
<p>There are two types of <a id="sthref902"></a>error conditions to consider when implementing <code dir="ltr">SQLEXEC</code>:</p>
<ul>
<li>
<p>The column map requires a column that is missing from the source database operation. This can occur for an update operation if the database only logs the values of columns that changed, rather than all of the column values. By default, when a required column is missing, or when an Oracle GoldenGate column-conversion function results in a "column missing" condition, the stored procedure does not execute. Subsequent attempts to extract an output parameter from the stored procedure results in a "column missing condition" in the <code dir="ltr">COLMAP</code> or <code dir="ltr">FILTER</code> clause.</p>
</li>
<li>
<p>The database generates an error.</p>
</li>
</ul>
<div id="GWUAD1123" class="sect3"><a id="sthref903"></a>
<h4 class="sect3"><span class="secnum">17.1.6.1</span> Handling Missing Column Values</h4>
<p>Use the <code dir="ltr">@COLTEST</code> function to test the results of the parameter that was passed, and then map an alternative value for the column to compensate for missing values, if desired. Otherwise, to ensure that column values are available, you can use the <code dir="ltr"><a id="sthref904"></a><a id="sthref905"></a><a id="sthref906"></a><a id="sthref907"></a>FETCHCOLS</code> or <code dir="ltr">FETCHCOLSEXCEPT</code> option of the <code dir="ltr">TABLE</code> parameter to fetch the values from the database if they are not present in the log. As an alternative to fetching columns, you can enable supplemental logging for those columns.</p>
</div>
<!-- class="sect3" -->
<div id="GWUAD1124" class="sect3"><a id="sthref908"></a>
<h4 class="sect3"><span class="secnum">17.1.6.2</span> Handling Database Errors</h4>
<p>Use the <code dir="ltr"><a id="sthref909"></a>ERROR</code> option in the <code dir="ltr">SQLEXEC</code> clause to direct Oracle GoldenGate to respond in one of the following ways:</p>
<div id="GWUAD587" class="tblhruleformal"><p class="titleintable"><a id="sthref910"></a><a id="sthref911"></a>Table 17-1 ERROR Options</p>
<table class="cellalignment160" title="ERROR Options" summary="This table shows how to use the ERROR option in the SQLEXEC clause. It lists and describes each action.">
<thead>
<tr class="cellalignment151">
<th class="cellalignment161" id="r1c1-t7">Action</th>
<th class="cellalignment161" id="r1c2-t7">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment151">
<td class="cellalignment157" id="r2c1-t7" headers="r1c1-t7">
<pre dir="ltr">
<a id="sthref912"></a>IGNORE
</pre></td>
<td class="cellalignment157" headers="r2c1-t7 r1c2-t7">
<p>Causes Oracle GoldenGate to ignore all errors associated with the stored procedure or query and continue processing. Any resulting parameter extraction results in a "column missing" condition. This is the default.</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r3c1-t7" headers="r1c1-t7">
<pre dir="ltr">
REPORT
</pre></td>
<td class="cellalignment157" headers="r3c1-t7 r1c2-t7">
<p>Ensures that all errors associated with the stored procedure or query are reported to the discard file. The <a id="sthref913"></a>report is useful for tracing the cause of the error. It includes both an error description and the value of the parameters passed to and from the procedure or query. Oracle GoldenGate continues processing after reporting the error.</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r4c1-t7" headers="r1c1-t7">
<pre dir="ltr">
RAISE
</pre></td>
<td class="cellalignment157" headers="r4c1-t7 r1c2-t7">
<p>Handles errors according to rules set by a <code dir="ltr">REPERROR</code> parameter specified in the Replicat parameter file. Oracle GoldenGate continues processing other stored procedures or queries associated with the current <code dir="ltr">TABLE</code> or <code dir="ltr">MAP</code> statement before processing the error.</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r5c1-t7" headers="r1c1-t7">
<pre dir="ltr">
FINAL
</pre></td>
<td class="cellalignment157" headers="r5c1-t7 r1c2-t7">
<p>Performs in a similar way to <code dir="ltr">RAISE</code> except that when an error associated with a procedure or query is encountered, any remaining stored procedures and queries are bypassed. Error processing is called immediately after the error.</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r6c1-t7" headers="r1c1-t7">
<pre dir="ltr">
FATAL
</pre></td>
<td class="cellalignment157" headers="r6c1-t7 r1c2-t7">
<p>Causes Oracle GoldenGate to abend immediately upon encountering an error associated with a procedure or query.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformal" --></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<div id="GWUAD588" class="sect2"><a id="sthref914"></a>
<h3 class="sect2"><span class="secnum">17.1.7</span> Additional SQLEXEC Guidelines</h3>
<p>Observe the following <code dir="ltr">SQLEXEC</code> guidelines:</p>
<ul>
<li>
<p>Up to 20 stored procedures or queries can be executed per <code dir="ltr">TABLE</code> or <code dir="ltr">MAP</code> entry. They execute in the order listed in the parameter statement.</p>
</li>
<li>
<p>A database login by the Oracle GoldenGate user must precede the <code dir="ltr">SQLEXEC</code> clause. Use the <a id="sthref915"></a><code dir="ltr">SOURCEDB</code> and/or <code dir="ltr">USERID</code> or <code dir="ltr">USERIDALIAS</code> parameter in the Extract parameter file or the <a id="sthref916"></a><code dir="ltr">TARGETDB</code> and/or <code dir="ltr">USERID</code> or <code dir="ltr">USERIDALIAS</code> parameter in the Replicat parameter file, as needed for the database type and configured authentication method.</p>
</li>
<li>
<p>The SQL is executed by the Oracle GoldenGate user. This user must have the privilege to execute stored procedures and call RDBM-supplied procedures.</p>
</li>
<li>
<p>Database operations within a stored procedure or query are committed in same context as the original transaction.</p>
</li>
<li>
<p>Do not use <code dir="ltr">SQLEXEC</code> to update the value of a primary key column. If <code dir="ltr">SQLEXEC</code> is used to update the value of a key column, then the Replicat process will not be able to perform a subsequent update or delete operation, because the original key value will be unavailable. If a key value must be changed, you can map the original key value to another column and then specify that column with the <code dir="ltr">KEYCOLS</code> option of the <code dir="ltr">TABLE</code> or <code dir="ltr">MAP</code> parameter.</p>
</li>
<li>
<p>For DB2, Oracle GoldenGate uses the ODBC <code dir="ltr">SQLExecDirect</code> function to execute a SQL statement dynamically. This means that the connected database server must be able to prepare the statement dynamically. ODBC prepares the SQL statement every time it is executed (at the requested interval). Typically, this does not present a problem to Oracle GoldenGate users. See the IBM DB2 documentation for more information.</p>
</li>
<li>
<p>Do not use <code dir="ltr">SQLEXEC</code> for objects being processing by a data-pump Extract in pass-through mode.</p>
</li>
<li>
<p>All object names in a <code dir="ltr">SQLEXEC</code> statement must be fully qualified with their two-part or three-part names, as appropriate for the database.</p>
</li>
<li>
<p>All objects that are affected by a <code dir="ltr">SQLEXEC</code> stored procedure or query must exist with the correct structures prior to the execution of the SQL. Consequently, DDL on these objects that affects structure (such as <code dir="ltr">CREATE</code> or <code dir="ltr">ALTER</code>) must happen before the <code dir="ltr">SQLEXEC</code> executes.</p>
</li>
<li>
<p>All objects affected by a standalone <code dir="ltr">SQLEXEC</code> statement must exist before the Oracle GoldenGate processes start. Because of this, DDL support must be disabled for those objects; otherwise, DDL operations could change the structure or delete the object before the <code dir="ltr">SQLEXEC</code> procedure or query executes on it.</p>
</li>
<li>
<p>For Informix, when Replicate is used to replicate data to multiple target databases in the same process, the <code dir="ltr">DBOPTIONS SPTHREAD</code> parameter and option must be used in the Replicat parameter file. For other uses of <code dir="ltr">SQLEXEC</code>, this parameter is not mandatory.</p>
</li>
</ul>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1048675"></a>
<div id="GWUAD589" class="sect1">
<h2 class="sect1"><span class="secnum">17.2</span> Using Oracle GoldenGate Macros to Simplify and Automate Work</h2>
<p>You can use Oracle GoldenGate macros in parameter files to configure and reuse parameters, commands, and conversion functions. reducing the amount of text you must enter to do common tasks. A macro is a built-in automation tool that enables you to call a stored set of processing steps from within the Oracle GoldenGate parameter file. A macro can consist of a simple set of frequently used parameter statements to a complex series of parameter substitutions, calculations, or conversions. You can call other macros from a macro. You can store commonly used macros in a library, and then call the library rather than call the macros individually.</p>
<p>Oracle GoldenGate macros work with the following parameter files:</p>
<ul>
<li>
<p>DEFGEN</p>
</li>
<li>
<p>Extract</p>
</li>
<li>
<p>Replicat</p>
</li>
</ul>
<p>Do not use macros to manipulate data for tables that are being processed by a data-pump Extract in pass-through mode.</p>
<p>There are two steps to using macros:</p>
<p><a href="#i1000271">Defining a Macro</a></p>
<p><a href="#i1000357">Calling a Macro</a></p>
<a id="i1000271"></a>
<div id="GWUAD590" class="sect2">
<h3 class="sect2"><span class="secnum">17.2.1</span> Defining <a id="sthref917"></a>a Macro</h3>
<p>To define an Oracle GoldenGate macro, use the <code dir="ltr">MACRO</code> parameter in the parameter file. <code dir="ltr">MACRO</code> defines any input parameters that are needed and it defines the work that the macro performs.</p>
<p class="subhead2"><a id="GWUAD591"></a>Syntax</p>
<pre dir="ltr">
MACRO #<span class="codeinlineitalic">macro_name</span>
PARAMS (#<span class="codeinlineitalic">p1</span>, #<span class="codeinlineitalic">p2</span> [, ...])
BEGIN
<span class="codeinlineitalic">macro_body</span>
END;
</pre>
<div id="GWUAD592" class="tblhruleformal"><p class="titleintable"><a id="sthref918"></a><a id="sthref919"></a>Table 17-2 Macro Definition Arguments</p>
<table class="cellalignment160" title="Macro Definition Arguments" summary="This table describes the macro definition arguments.">
<thead>
<tr class="cellalignment151">
<th class="cellalignment161" id="r1c1-t8">Argument</th>
<th class="cellalignment161" id="r1c2-t8">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment151">
<td class="cellalignment157" id="r2c1-t8" headers="r1c1-t8">
<pre dir="ltr">
<a id="sthref920"></a>MACRO
</pre></td>
<td class="cellalignment157" headers="r2c1-t8 r1c2-t8">
<p>Required. Indicates the start of an Oracle GoldenGate macro definition.</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r3c1-t8" headers="r1c1-t8">
<pre dir="ltr">
#<span class="codeinlineitalic">macro_name</span>
</pre></td>
<td class="cellalignment157" headers="r3c1-t8 r1c2-t8">
<p>The name of the macro. Macro and parameter names must begin with a macro character. The default macro character is the pound (#) character, as in <code dir="ltr">#macro1</code> and <code dir="ltr">#param1</code>.</p>
<p>A macro or parameter name can be one word consisting of letters and numbers, or both. Special characters, such as the underscore character (<code dir="ltr">_</code>) or hyphen <code dir="ltr">(-</code>), can be used. Some examples of macro names are: <code dir="ltr">#mymacro</code>, <code dir="ltr">#macro1</code>, <code dir="ltr">#macro_1</code>, <code dir="ltr">#macro-1</code>, <code dir="ltr">#macro$</code>. Some examples of parameter names are <code dir="ltr">#sourcecol</code>, <code dir="ltr">#s</code>, <code dir="ltr">#col1</code>, and <code dir="ltr">#col_1</code>.</p>
<p>To avoid parsing errors, the macro character cannot be used as the first character of a macro name. For example, <code dir="ltr">##macro</code> is invalid. If needed, you can change the macro character by using the <code dir="ltr">MACROCHAR</code> parameter. See <a class="olink GWURF542" href="../../gg-winux/GWURF/gg_parameters097.htm#GWURF542"><span class="italic">Reference for Oracle GoldenGate for Windows and UNIX</span></a>.</p>
<p>Macro and parameter names are not <a id="sthref921"></a>case-sensitive. Macro or parameter names within quotation marks are ignored.</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r4c1-t8" headers="r1c1-t8">
<pre dir="ltr">
<a id="sthref922"></a>PARAMS (#<span class="codeinlineitalic">p1</span>, #<span class="codeinlineitalic">p2</span>)
</pre></td>
<td class="cellalignment157" headers="r4c1-t8 r1c2-t8">
<p>Optional definition of input parameters. Specify a comma-separated list of parameter names and enclose it within parentheses. Each parameter must be referenced in the macro body where you want input values to be substituted. You can list each parameter on a separate line to improve readability (making certain to use the open and close parentheses to enclose the parameter list). See <a href="#i1050535">Section 17.2.2.1, "Calling a Macro that Contains Parameters"</a> for more information.</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r5c1-t8" headers="r1c1-t8">
<pre dir="ltr">
<a id="sthref923"></a>BEGIN
</pre></td>
<td class="cellalignment157" headers="r5c1-t8 r1c2-t8">
<p>Begins the macro body. Must be specified before the macro body.</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r6c1-t8" headers="r1c1-t8">
<pre dir="ltr">
<span class="codeinlineitalic">macro_body</span>
</pre></td>
<td class="cellalignment157" headers="r6c1-t8 r1c2-t8">
<p>The macro body. The body is a syntax statement that defines the function that is to be performed by the macro. A macro body can include any of the following types of statements.</p>
<ul>
<li>
<p>Simple parameter statements, as in:</p>
<pre dir="ltr">
COL1 = COL2
</pre></li>
<li>
<p>Complex parameter statements with parameter substitution as in:</p>
<pre dir="ltr">
MAP #o.#t, TARGET #o.#t, KEYCOLS (#k), COLMAP (USEDEFAULTS); 
</pre></li>
<li>
<p>Invocations of other macros, as in:</p>
<pre dir="ltr">
#colmap (COL1, #sourcecol)
</pre></li>
</ul>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r7c1-t8" headers="r1c1-t8">
<pre dir="ltr">
<a id="sthref924"></a>END;
</pre></td>
<td class="cellalignment157" headers="r7c1-t8 r1c2-t8">
<p>Ends the macro definition. The semicolon is required to complete the definition.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformal" -->
<p>The following is an example of a macro definition that includes parameters. In this case, the macro simplifies the task of object and column mapping by supplying the base syntax of the <code dir="ltr">MAP</code> statement with input parameters that resolve to the names of the owners, the tables, and the <code dir="ltr">KEYCOLS</code> columns.</p>
<pre dir="ltr">
MACRO #macro1  
PARAMS ( #o, #t, #k )  
BEGIN  
MAP #o.#t, TARGET #o.#t, KEYCOLS (#k), COLMAP (USEDEFAULTS); 
END; 
</pre>
<p>The following is an example of a macro that does not define parameters. It executes a frequently used set of parameters.</p>
<pre dir="ltr">
MACRO #option_defaults
BEGIN
GETINSERTS
GETUPDATES
GETDELETES
INSERTDELETES
END;
</pre></div>
<!-- class="sect2" -->
<a id="i1000357"></a>
<div id="GWUAD594" class="sect2">
<h3 class="sect2"><span class="secnum">17.2.2</span> Calling a <a id="sthref925"></a>Macro</h3>
<p>This section shows you how to call a macro. (To define a macro, see <a href="#i1000271">Section 17.2.1, "Defining a Macro"</a>).</p>
<p>To call a macro, use the following syntax where you want the macro to run within the parameter file.</p>
<p class="subhead2"><a id="GWUAD595"></a>Syntax</p>
<pre dir="ltr">
[<span class="codeinlineitalic">target</span> =] <span class="codeinlineitalic">macro_name</span> (<span class="codeinlineitalic">val</span>[, ...])
</pre>
<pre dir="ltr">
[<span class="codeinlineitalic">target</span> =] <span class="codeinlineitalic">macro_name</span> (<span class="codeinlineitalic">val</span> | {<span class="codeinlineitalic">val</span>, <span class="codeinlineitalic">val</span>, ...}[, ...])
</pre>
<div id="GWUAD1189" class="tblhruleformal"><p class="titleintable"><a id="sthref926"></a><a id="CHDEDJBG"></a>Table 17-3 Syntax Elements for Calling a Macro</p>
<table class="cellalignment160" title="Syntax Elements for Calling a Macro" summary="Describes the syntax for invoking a macro.">
<thead>
<tr class="cellalignment151">
<th class="cellalignment161" id="r1c1-t9">Argument</th>
<th class="cellalignment161" id="r1c2-t9">Description</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment151">
<td class="cellalignment157" id="r2c1-t9" headers="r1c1-t9">
<p><code dir="ltr"><span class="codeinlineitalic">target =</span></code></p>
</td>
<td class="cellalignment157" headers="r2c1-t9 r1c2-t9">
<p>Optional. Specifies the target to which the results of the macro are assigned or mapped. For example, <code dir="ltr">target</code> can be used to specify a target column in a <code dir="ltr">COLMAP</code> statement. In the following call to the <code dir="ltr">#make_date</code> macro, the column <code dir="ltr">DATECOL1</code> is the target and will be mapped to the macro results.</p>
<pre dir="ltr">
DATECOL1 = #make_date (YR1, MO1, DAY1)
</pre>
<p>Without a target, the syntax to call <code dir="ltr">#make_date</code> is:</p>
<pre dir="ltr">
#make_date (YR1, MO1, DAY1)
</pre></td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r3c1-t9" headers="r1c1-t9">
<p><code dir="ltr"><span class="codeinlineitalic">macro_name</span></code></p>
</td>
<td class="cellalignment157" headers="r3c1-t9 r1c2-t9">
<p>The name of the macro that is being called, for example: <code dir="ltr">#make_date</code>.</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r4c1-t9" headers="r1c1-t9">
<p><code dir="ltr">(</code> <code dir="ltr"><span class="codeinlineitalic">val</span></code><code dir="ltr">[, ...]</code>)</p>
</td>
<td class="cellalignment157" headers="r4c1-t9 r1c2-t9">
<p>The parameter input values. This component is required whether or not the macro defines parameters. If the macro defines parameters, specify a comma-separated list of input values, in the order that corresponds to the parameter definitions in the <code dir="ltr">MACRO</code> parameter, and enclose the list within parentheses. If the macro does not define parameters, specify the open and close parentheses with nothing between them (). For more information about this syntax, see the following:</p>
<p><a href="#i1050535">Section 17.2.2.1, "Calling a Macro that Contains Parameters."</a></p>
<p><a href="#CHDHBFIA">Section 17.2.2.2, "Calling a Macro without Input Parameters."</a></p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r5c1-t9" headers="r1c1-t9">
<p><code dir="ltr">(</code> <code dir="ltr"><span class="codeinlineitalic">val</span></code> <code dir="ltr">| {</code><code dir="ltr"><span class="codeinlineitalic">val</span></code><code dir="ltr">,</code> <code dir="ltr"><span class="codeinlineitalic">val</span></code><code dir="ltr">, ...} )[, ...]</code></p>
</td>
<td class="cellalignment157" headers="r5c1-t9 r1c2-t9">
<p>The parameter input values. This component is required whether or not the macro defines parameters. If the macro defines parameters, specify a comma-separated list of input values, in the order that corresponds to the parameter definitions in the <code dir="ltr">MACRO</code> parameter, and enclose the list within parentheses. To pass multiple values to one parameter, separate them with commas and enclose the list within curly brackets. If the macro does not define parameters, specify the open and close parentheses with nothing between them (). For more information about this syntax, see the following:</p>
<p><a href="#i1050535">Section 17.2.2.1, "Calling a Macro that Contains Parameters."</a></p>
<p><a href="#CHDHBFIA">Section 17.2.2.2, "Calling a Macro without Input Parameters."</a></p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformal" -->
<a id="i1050535"></a>
<div id="GWUAD597" class="sect3">
<h4 class="sect3"><span class="secnum">17.2.2.1</span> Calling a Macro that Contains Parameters</h4>
<p>To call a macro that contains parameters, the call statement must supply the input values that are to be substituted for those parameters when the macro runs. See the syntax in <a href="#CHDEDJBG">Table 17-3</a>.</p>
<p>Valid input for a macro parameter is any of the following, preceded by the macro character (default is #):</p>
<ul>
<li>
<p>A single value in plain or quoted text, such as: <code dir="ltr">#macro (#name, #address, #phone)</code> or <code dir="ltr">#macro (#"name", #"address", #"phone")</code>.</p>
</li>
<li>
<p>A comma-separated list of values enclosed within curly brackets, such as: <code dir="ltr">#macro1 (SCOTT, DEPT, {DEPTNO1, DEPTNO2, DEPTNO3})</code>. The ability to substitute a block of values for any given parameter add flexibility to the macro definition and its usability in the Oracle GoldenGate configuration.</p>
</li>
<li>
<p>Calls to other macros, such as: <code dir="ltr">#macro (#mycalc (col2, 100), #total)</code>. In this example, the <code dir="ltr">#mycalc</code> macro is called with the input values of <code dir="ltr">col2</code> and <code dir="ltr">100</code>.</p>
</li>
</ul>
<p>Oracle GoldenGate substitutes parameter values within the macro body according to the following rules.</p>
<ol>
<li>
<p>The macro processor reads through the macro body looking for instances of parameter names specified in the <code dir="ltr">PARAMS</code> statement.</p>
</li>
<li>
<p>For each occurrence of the parameter name, the corresponding parameter value specified during the call is substituted.</p>
</li>
<li>
<p>If a parameter name does not appear in the <code dir="ltr">PARAMS</code> statement, the macro processor evaluates whether or not the item is, instead, a call to another macro. (See <a href="#i1000457">Section 17.2.3, "Calling Other Macros from a Macro"</a>.) If the call succeeds, the nested macro is executed. If it fails, the whole macro fails.</p>
</li>
</ol>
<div id="GWUAD1190" class="example"><p class="titleinexample"><a id="sthref927"></a>Example 17-3 Using Parameters to Populate a MAP Statement</p>
<p>The following macro definition specifies three parameter that must be resolved. The parameters substitute for the names of the table owner (parameter <code dir="ltr">#o</code>), the table (parameter <code dir="ltr">#t</code>), and the <code dir="ltr">KEYCOLS</code> columns (parameter <code dir="ltr">#k</code>) in a <code dir="ltr">MAP</code> statement.</p>
<pre dir="ltr">
MACRO #macro1  PARAMS ( #o, #t, #k )  BEGIN  MAP #o.#t, TARGET #o.#t, KEYCOLS (#k), COLMAP (USEDEFAULTS); END; 
</pre>
<p>Assuming a table in the <code dir="ltr">MAP</code> statement requires only one <code dir="ltr">KEYCOLS</code> column, the following syntax can be used to call <code dir="ltr">#macro1</code>. In this syntax, the <code dir="ltr">#k</code> parameter can be resolved with only one value.</p>
<pre dir="ltr">
#macro1 (SCOTT, DEPT, DEPTNO1)
</pre></div>
<!-- class="example" -->
<div id="GWUAD1191" class="example"><p class="titleinexample"><a id="CHDBDJFA"></a>Example 17-4 Using a Macro to Perform Conversion</p>
<p>In this example, a macro defines the parameters <code dir="ltr">#year</code>, <code dir="ltr">#month</code>, and <code dir="ltr">#day</code> to convert a proprietary date format.</p>
<pre dir="ltr">
MACRO #make_date
PARAMS (#year, #month, #day)
BEGIN
@DATE ('YYYY-MM-DD', 'CC', @IF (#year &lt; 50, 20, 19), 'YY', #year, 'MM', #month, 'DD', #day)
END;
</pre>
<p>The macro is called in the <code dir="ltr">COLMAP</code> clause:</p>
<pre dir="ltr">
MAP sales.acct_tab, TARGET sales.account,
COLMAP
(
targcol1 = sourcecol1,
datecol1 = #make_date(YR1, MO1, DAY1),
datecol2 = #make_date(YR2, MO2, DAY2)
);
</pre>
<p>The macro expands as follows:</p>
<pre dir="ltr">
MAP sales.acct_tab, TARGET sales.account,
COLMAP
(
targcol1 = sourcecol1,
datecol1 = @DATE ('YYYY-MM-DD', 'CC', @IF (YR1 &lt; 50, 20, 19),'YY', YR1, 'MM', MO1, 'DD', DAY1),
datecol2 = @DATE ('YYYY-MM-DD', 'CC', @IF (YR2 &lt; 50, 20, 19),'YY', YR2, 'MM', MO2, 'DD', DAY2)
);
</pre></div>
<!-- class="example" --></div>
<!-- class="sect3" -->
<a id="CHDHBFIA"></a>
<div id="GWUAD599" class="sect3">
<h4 class="sect3"><span class="secnum">17.2.2.2</span> Calling a Macro without Input Parameters</h4>
<p>To call a macro without input parameters, the call statement must supply the open and close parentheses, but without any input values: <code dir="ltr">#macro ()</code>.</p>
<p>The following macro is defined without input parameters. The body contains frequently used parameters.</p>
<pre dir="ltr">
MACRO #option_defaults
BEGIN
GETINSERTS
GETUPDATES
GETDELETES
INSERTDELETES
END;
</pre>
<p>This macro is called as follows:</p>
<pre dir="ltr">
#option_defaults ()
IGNOREUPDATES
MAP owner.srctab, TARGET owner.targtab;

#option_defaults ()
MAP owner.srctab2, TARGET owner.targtab2;
</pre>
<p>The macro expands as follows:</p>
<pre dir="ltr">
GETINSERTS
GETUPDATES
GETDELETES
INSERTDELETES
IGNOREUPDATES
MAP owner.srctab, TARGET owner.targtab;

GETINSERTS
GETUPDATES
GETDELETES
INSERTDELETES
MAP owner.srctab2, TARGET owner.targtab2;
</pre></div>
<!-- class="sect3" --></div>
<!-- class="sect2" -->
<a id="i1000457"></a>
<div id="GWUAD601" class="sect2">
<h3 class="sect2"><span class="secnum">17.2.3</span> Calling Other Macros from a <a id="sthref928"></a>Macro</h3>
<p>To call other macros from a macro, create a macro definition similar to the following. In this example, the <code dir="ltr">#make_date</code> macro is nested within the <code dir="ltr">#assign_date</code> macro, and it is called when <code dir="ltr">#assign_date</code> runs.</p>
<p>The nested macro must define all, or a subset of, the same parameters that are defined in the base macro. In other words, the input values when the base macro is called must resolve to the parameters in both macros.</p>
<p>The following defines <code dir="ltr">#assign_date</code>:</p>
<pre dir="ltr">
MACRO #assign_date
PARAMS (#target_col, #year, #month, #day)
BEGIN
#target_col = #make_date (#year, #month, #day)
END;
</pre>
<p>The following defines <code dir="ltr">#make_date</code>. This macro creates a date format that includes a four-digit year, after first determining whether the two-digit input date should be prefixed with a century value of 19 or 20. Notice that the <code dir="ltr">PARAMS</code> statement of <code dir="ltr">#make_date</code> contains a subset of the parameters in the <code dir="ltr">#assign_date</code> macro.</p>
<pre dir="ltr">
MACRO #make_date
PARAMS (#year, #month, #day)
BEGIN
@DATE ('YYYY-MM-DD', 'CC', @IF (#year &lt; 50, 20, 19), 'YY', #year, 'MM', #month, 'DD', #day)
END;
</pre>
<p>The following syntax calls <code dir="ltr">#assign_date</code>:</p>
<pre dir="ltr">
#assign_date (COL1, YEAR, MONTH, DAY)
</pre>
<p>The macro expands to the following given the preceding input values and the embedded <code dir="ltr">#make_date</code> macro:</p>
<pre dir="ltr">
COL1 = @DATE ('YYYY-MM-DD', 'CC', @IF (YEAR &lt; 50, 20, 19),'YY', YEAR, 'MM', MONTH, 'DD', DAY)
</pre></div>
<!-- class="sect2" -->
<div id="GWUAD602" class="sect2"><a id="sthref929"></a>
<h3 class="sect2"><span class="secnum">17.2.4</span> Creating <a id="sthref930"></a>Macro<a id="sthref931"></a> Libraries</h3>
<p>You can create a macro library that contains one or more macros. By using a macro library, you can define a macro once and then use it within many parameter files.</p>
<p class="subhead2"><a id="GWUAD1126"></a>To create a macro library</p>
<ol>
<li>
<p>Open a new file in a text editor.</p>
</li>
<li>
<p>Use commented lines to describe the library, if needed.</p>
</li>
<li>
<p>Using the syntax described in <a href="#i1000271">Section 17.2.1, "Defining a Macro"</a>, enter the syntax for each macro.</p>
</li>
<li>
<p>Save the file in the <code dir="ltr">dirprm</code> sub-directory of the Oracle GoldenGate directory as:</p>
<pre dir="ltr">
<span class="italic">filename</span>.mac
</pre>
<p>Where:</p>
<p><code dir="ltr"><span class="codeinlineitalic">filename</span></code> is the name of the file. The <code dir="ltr">.mac</code> extension defines the file as a macro library.</p>
</li>
</ol>
<p>The following sample library named <code dir="ltr">datelib</code> contains two macros, <code dir="ltr">#make_date</code> and <code dir="ltr">#assign_date</code>.</p>
<pre dir="ltr">
-- datelib macro library
--
MACRO #make_date
PARAMS (#year, #month, #day)
BEGIN
@DATE ('YYYY-MM-DD', 'CC', @IF (#year &lt; 50, 20, 19), 'YY', #year, 'MM', #month, 'DD', #day)
END;

MACRO #assign_date
PARAMS (#target_col, #year, #month, #day)
BEGIN
#target_col = #make_date (#year, #month, #day)
END;
</pre>
<p>To use a macro library, use the <code dir="ltr"><a id="sthref932"></a>INCLUDE</code> parameter at the beginning of a parameter file, as shown in the following sample Replicat parameter file.</p>
<pre dir="ltr">
INCLUDE /ggs/dirprm/datelib.mac
REPLICAT rep
ASSUMETARGETDEFS
USERIDALIAS ogg
MAP fin.acct_tab, TARGET fin.account;
</pre>
<p>When including a long macro library in a parameter file, you can use the <code dir="ltr"><a id="sthref933"></a>NOLIST</code> parameter to suppress the listing of each macro in the Extract or Replicat report file. Listing can be turned on and off by placing the <code dir="ltr">LIST</code> and <code dir="ltr">NOLIST</code> parameters anywhere within the parameter file or within the macro library file. In the following example, <code dir="ltr">NOLIST</code> suppresses the listing of each macro in the <code dir="ltr">hugelib</code> macro library. Specifying <code dir="ltr">LIST</code> after the <code dir="ltr">INCLUDE</code> statement restores normal listing to the report file.</p>
<pre dir="ltr">
NOLIST
INCLUDE /ggs/dirprm/hugelib.mac
LIST
INCLUDE /ggs/dirprm/mdatelib.mac
REPLICAT REP
</pre></div>
<!-- class="sect2" -->
<a id="CHDJIIFE"></a>
<div id="GWUAD605" class="sect2">
<h3 class="sect2"><span class="secnum">17.2.5</span> Tracing Macro <a id="sthref934"></a><a id="sthref935"></a>Expansion</h3>
<p>You can trace macro expansion with the <code dir="ltr"><a id="sthref936"></a>CMDTRACE</code> parameter. With <code dir="ltr">CMDTRACE</code> enabled, macro expansion steps are shown in the Extract or Replicat report file.</p>
<p class="subhead2"><a id="GWUAD606"></a>Syntax</p>
<pre dir="ltr">
CMDTRACE [ON | OFF | DETAIL]
</pre>
<p>Where:</p>
<ul>
<li>
<p><code dir="ltr">ON</code> enables tracing.</p>
</li>
<li>
<p><code dir="ltr">OFF</code> disables tracing.</p>
</li>
<li>
<p><code dir="ltr">DETAIL</code> produces a verbose display of macro expansion.</p>
</li>
</ul>
<p>In the following example, tracing is enabled before <code dir="ltr">#testmac</code> is called, then disabled after the macro's execution.</p>
<pre dir="ltr">
REPLICAT REP
MACRO #testmac
BEGIN
COL1 = COL2,
COL3 = COL4,
END;
...
CMDTRACE ON
MAP test.table1, TARGET test.table2,
COLMAP (#testmac);
CMDTRACE OFF
</pre></div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1012304"></a>
<div id="GWUAD607" class="sect1">
<h2 class="sect1"><span class="secnum">17.3</span> Using User <a id="sthref937"></a><a id="sthref938"></a><a id="sthref939"></a>Exits to Extend Oracle GoldenGate Capabilities</h2>
<p><a id="sthref940"></a>User exits are custom routines that you write in <a id="sthref941"></a>C programming code and call during Extract or Replicat processing. User exits extend and customize the functionality of the Extract and Replicat processes with minimal complexity and risk. With user exits, you can respond to database events when they occur, without altering production programs.</p>
<div id="GWUAD608" class="sect2"><a id="sthref942"></a>
<h3 class="sect2"><span class="secnum">17.3.1</span> When to Implement User <a id="sthref943"></a>Exits</h3>
<p>You can employ user exits as an alternative to, or in conjunction with, the column-conversion functions that are available within Oracle GoldenGate. User exits can be a better alternative to the built-in functions because a user exit processes data only once (when the data is extracted) rather than twice (once when the data is extracted and once to perform the transformation).</p>
<p>The following are some ways in which you can implement user exits:</p>
<ul>
<li>
<p>Perform <a id="sthref944"></a>arithmetic operations, date conversions, or table lookups while mapping from one table to another.</p>
</li>
<li>
<p>Implement record archival functions offline.</p>
</li>
<li>
<p>Respond to unusual database events in custom ways, for example by sending an e-mail message or a page based on an output value.</p>
</li>
<li>
<p>Accumulate totals and gather statistics.</p>
</li>
<li>
<p>Manipulate a record.</p>
</li>
<li>
<p>Repair invalid data.</p>
</li>
<li>
<p>Calculate the net difference in a record before and after an update.</p>
</li>
<li>
<p>Accept or reject records for extraction or replication based on complex criteria.</p>
</li>
<li>
<p>Normalize a database during conversion.</p>
</li>
</ul>
</div>
<!-- class="sect2" -->
<div id="GWUAD609" class="sect2"><a id="sthref945"></a>
<h3 class="sect2"><span class="secnum">17.3.2</span> Making Oracle GoldenGate Record Information Available to the Routine</h3>
<p>The basis for most user exit processing is the <code dir="ltr">EXIT_CALL_PROCESS_RECORD</code> function. For Extract, this function is called just before a record buffer is output to the trail. For Replicat, it is called just before a record is applied to the target. If source-target mapping is specified in the parameter file, the <code dir="ltr">EXIT_CALL_PROCESS_RECORD</code> event takes place after the mapping is performed.</p>
<p>When <code dir="ltr">EXIT_CALL_PROCESS_RECORD</code> is called, the record buffer and other record information are available to it through callback routines. The user exit can map, transform, clean, or perform any other operation with the data record. When it is finished, the user exit can return a status indicating whether the record should be processed or ignored by Extract or Replicat.</p>
</div>
<!-- class="sect2" -->
<div id="GWUAD610" class="sect2"><a id="sthref946"></a>
<h3 class="sect2"><span class="secnum">17.3.3</span> <a id="sthref947"></a>Creating User Exits</h3>
<p>The following instructions help you to create user exits on Windows and UNIX systems. For more information about the parameters and functions that are described in these instructions, see <a class="olink GWURF831" href="../../gg-winux/GWURF/user_exit_functions.htm#GWURF831"><span class="italic">Reference for Oracle GoldenGate for Windows and UNIX</span></a>.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
User exits are case-sensitive for database object names. Names are returned exactly as they are defined in the hosting database. Object names must be fully qualified.</div>
<p class="subhead2"><a id="GWUAD1127"></a>To create <a id="sthref948"></a>user exits</p>
<ol>
<li>
<p>In C code, create either a shared object (UNIX systems) or a DLL (Windows) and create or export a routine to be called from Extract or Replicat. This routine is the communication point between Oracle GoldenGate and your routines. Name the routine whatever you want. The routine must accept the following Oracle GoldenGate user exit parameters:</p>
<ul>
<li>
<p><code dir="ltr">EXIT_CALL_TYPE</code>: Indicates when, during processing, the routine is called.</p>
</li>
<li>
<p><code dir="ltr">EXIT_CALL_RESULT</code>: Provides a response to the routine.</p>
</li>
<li>
<p><code dir="ltr">EXIT_PARAMS</code>: Supplies information to the routine. This function enables you to use the <code dir="ltr">EXITPARAM</code> option of the <code dir="ltr">TABLE</code> or <code dir="ltr">MAP</code> statement to pass a parameter that is a literal string to the user exit. This is only valid during the exit call to process a specific record. This function also enables you to pass parameters specified with the <code dir="ltr">PARAMS</code> option of the <code dir="ltr">CUSEREXIT</code> parameter at the exit call startup.</p>
</li>
</ul>
</li>
<li>
<p>In the source code, include the <code dir="ltr"><a id="sthref949"></a><a id="sthref950"></a>usrdecs.h</code> file. The <code dir="ltr">usrdecs.h</code> file is the include file for the user exit API. It contains type definitions, return status values, callback function codes, and a number of other definitions. The <code dir="ltr">usrdecs.h</code> file is installed within the Oracle GoldenGate directory. Do not modify this file.</p>
</li>
<li>
<p>Include Oracle GoldenGate <a id="sthref951"></a>callback routines in the user exit when applicable. Callback routines retrieve record and application context information, and they modify the contents of data records. To implement a callback routine, use the <code dir="ltr"><a id="sthref952"></a>ERCALLBACK</code> function in the shared object. The user callback routine behaves differently based on the function code that is passed to the callback routine.</p>
<pre dir="ltr">
ERCALLBACK (<span class="codeinlineitalic">function_code</span>, <span class="codeinlineitalic">buffer</span>, <span class="codeinlineitalic">result_code</span>);
</pre>
<p>Where:</p>
<ul>
<li>
<p><code dir="ltr"><span class="codeinlineitalic">function_code</span></code> is the function to be executed by the callback routine.</p>
</li>
<li>
<p><code dir="ltr"><span class="codeinlineitalic">buffer</span></code> is a void pointer to a buffer containing a predefined structure associated with the specified function code.</p>
</li>
<li>
<p><code dir="ltr"><span class="codeinlineitalic">result_code</span></code> is the status of the function that is executed by the callback routine. The result code that is returned by the callback routine indicates whether or not the callback function was successful.</p>
</li>
<li>
<p>On Windows systems, Extract and Replicat export the <code dir="ltr">ERCALLBACK</code> function that is to be called from the user exit routine. The user exit must explicitly load the callback function at run-time using the appropriate Windows API calls.</p>
</li>
</ul>
</li>
<li>
<p>Include the <code dir="ltr">CUSEREXIT</code> parameter in your Extract or Replicat parameter file. This parameter accepts the name of the shared object or DLL and the name of the exported routine that is to be called from Extract or Replicat. You can specify the full path of the shared object or DLL or let the operating system's standard search strategy locate the shared object.</p>
<pre dir="ltr">
CUSEREXIT {<span class="codeinlineitalic">DLL</span> | <span class="codeinlineitalic">shared_object</span>} <span class="codeinlineitalic">routine</span>
[, PASSTHRU]
[, INCLUDEUPDATEBEFORES]
[, PARAMS '<span class="codeinlineitalic">startup_string</span>']
</pre>
<p>Where:</p>
<ul>
<li>
<p><code dir="ltr"><span class="codeinlineitalic">DLL</span></code> is a Windows DLL and <code dir="ltr"><span class="codeinlineitalic">shared_object</span></code> is a UNIX shared object that contains the user exit function.</p>
</li>
<li>
<p><code dir="ltr">PASSTHRU</code> allows the use of a user exit with a data pump that is operating in pass-through mode.</p>
</li>
<li>
<p><code dir="ltr">INCLUDEUPDATEBEFORES</code> gets before images for <code dir="ltr">UPDATE</code> operations.</p>
</li>
<li>
<p><code dir="ltr">PARAMS</code> <code dir="ltr"><span class="codeinlineitalic">'startup_string'</span></code> supplies a startup string, such as a startup parameter.</p>
</li>
</ul>
</li>
</ol>
<div id="GWUAD613" class="example"><p class="titleinexample"><a id="sthref953"></a>Example 17-5 Example of Base Syntax, UNIX</p>
<pre dir="ltr">
CUSEREXIT eruserexit.so MyUserExit
</pre></div>
<!-- class="example" -->
<div id="GWUAD614" class="example"><p class="titleinexample"><a id="sthref954"></a>Example 17-6 Example Base Syntax, Windows</p>
<pre dir="ltr">
CUSEREXIT eruserexit.dll MyUserExit
</pre></div>
<!-- class="example" --></div>
<!-- class="sect2" -->
<a id="i1048764"></a>
<div id="GWUAD615" class="sect2">
<h3 class="sect2"><span class="secnum">17.3.4</span> Supporting Character-set Conversion in User Exits</h3>
<p>To maintain data integrity, a user exit needs to understand the character set of the character-type data that it exchanges with an Oracle GoldenGate process. Oracle GoldenGate user exit logic provides globalization support for:</p>
<ul>
<li>
<p>character-based database metadata, such as the names of catalogs, schemas, tables, and columns</p>
</li>
<li>
<p>the values of character-type columns, such as <code dir="ltr">CHAR</code>, <code dir="ltr">VARCHAR2</code>, <code dir="ltr">CLOB</code>, <code dir="ltr">NCHAR</code>, <code dir="ltr">NVARCHAR2</code>, and <code dir="ltr">NCLOB</code>, as well as string-based numbers, date-time, and intervals.</p>
</li>
</ul>
<p>Properly converting between character sets allows column data to be compared, manipulated, converted, and mapped properly from one type of database and character set to another. Most of this processing is performed when the <code dir="ltr">EXIT_CALL_PROCESS_RECORD</code> call type is called and the record buffer and other record information is made available through callback routines.</p>
<p>The user exit has its own session character set. This is defined by the <code dir="ltr">GET_SESSION_CHARSET</code> and <code dir="ltr">SET_SESSION_CHARSET</code> callback functions. The caller process provides conversion between character sets if the character set of the user exit is different from the hosting context of the process.</p>
<p>To enable this support in user exits, there is the <code dir="ltr">GET_DATABASE_METADATA</code> callback function code. This function enables the user exit to get database metadata, such as the locale and the character set of the character-type data that it exchanges with the process that calls it (Extract, data pump, Replicat). It also returns how the database treats the case-sensitivity of object names, how it treats quoted and unquoted names, and how it stores object names.</p>
<p>For more information about these components, see <a class="olink GWURF831" href="../../gg-winux/GWURF/user_exit_functions.htm#GWURF831"><span class="italic">Reference for Oracle GoldenGate for Windows and UNIX</span></a>.</p>
</div>
<!-- class="sect2" -->
<a id="CHDCCDCF"></a>
<div id="GWUAD616" class="sect2">
<h3 class="sect2"><span class="secnum">17.3.5</span> Using Macros to Check Name Metadata</h3>
<p>The object name that is passed by the user exit API is the exact name that is encoded in the user-exit session character set, and exactly the same name that is retrieved from the database. If the user exit compares the object name with a literal string, the user exit must retrieve the database locale and then normalize the string so that it is compared with the object name in the same encoding.</p>
<p>Oracle GoldenGate provides the following macros that can be called by the user exit to check the metadata of database object names. For example, a macro can be used to check whether a quoted table name is case-sensitive and whether it is stored as mixed-case in the database server. These macros are defined in the <code dir="ltr">usrdecs.h</code> file.</p>
<div id="GWUAD617" class="tblhruleformal"><p class="titleintable"><a id="sthref955"></a><a id="sthref956"></a>Table 17-4 Macros for metadata checking</p>
<table class="cellalignment160" title="Macros for metadata checking" summary="This table shows macros for checking the metadata of database object names.">
<thead>
<tr class="cellalignment151">
<th class="cellalignment161" id="r1c1-t11">Macro</th>
<th class="cellalignment161" id="r1c2-t11">What it verifies</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment151">
<td class="cellalignment157" id="r2c1-t11" headers="r1c1-t11">
<p><code dir="ltr">supportsMixedCaseIdentifiers( nameMeta, DbObjType )</code></p>
</td>
<td class="cellalignment157" headers="r2c1-t11 r1c2-t11">
<p>Whether the database treats a mixed-case unquoted name of a specified data type as case-sensitive and stores the name in mixed case.</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r3c1-t11" headers="r1c1-t11">
<p><code dir="ltr">supportsMixedCaseQuotedIdentifiers( nameMeta, DBObjType )</code></p>
</td>
<td class="cellalignment157" headers="r3c1-t11 r1c2-t11">
<p>Whether the database treats the mixed-case quoted name of a specified data type as case-sensitive and stores the name in mixed case.</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r4c1-t11" headers="r1c1-t11">
<p><code dir="ltr">storesLowerCaseIdentifiers( nameMeta, DbObjType )</code></p>
</td>
<td class="cellalignment157" headers="r4c1-t11 r1c2-t11">
<p>Whether the database treats the mixed-case unquoted name of a specified data type as case-insensitive and stores the name in lower case.</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r5c1-t11" headers="r1c1-t11">
<p><code dir="ltr">storesLowerCaseQuotedIdentifiers( nameMeta, DbObjType )</code></p>
</td>
<td class="cellalignment157" headers="r5c1-t11 r1c2-t11">
<p>Whether the database treats the mixed-case quoted name of a specified data type as case-insensitive and stores the name in lower case.</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r6c1-t11" headers="r1c1-t11">
<p><code dir="ltr">storesMixedCaseIdentifiers( nameMeta, DbObjType )</code></p>
</td>
<td class="cellalignment157" headers="r6c1-t11 r1c2-t11">
<p>Whether the database treats the mixed-case unquoted name of a specified data type as case-insensitive and stores the name in mixed case.</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r7c1-t11" headers="r1c1-t11">
<p><code dir="ltr">storesMixedCaseQuotedIdentifiers( nameMeta, DbObjType )</code></p>
</td>
<td class="cellalignment157" headers="r7c1-t11 r1c2-t11">
<p>Whether the database treats the mixed-case quoted name of a specified data type as case-insensitive and stores the name in mixed case.</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r8c1-t11" headers="r1c1-t11">
<p><code dir="ltr">storesUpperCaseIdentifiers( nameMeta, DbObjType )</code></p>
</td>
<td class="cellalignment157" headers="r8c1-t11 r1c2-t11">
<p>Whether the database treats the mixed-case unquoted name of a specified data type as case-insensitive and stores the name in upper case.</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r9c1-t11" headers="r1c1-t11">
<p><code dir="ltr">storesUpperCaseQuotedIdentifiers( nameMeta, DbObjType )</code></p>
</td>
<td class="cellalignment157" headers="r9c1-t11 r1c2-t11">
<p>Whether the database treats the mixed-case quoted name of a specified data type as case-insensitive and stores the name in upper case.</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformal" --></div>
<!-- class="sect2" -->
<a id="CHDEGFHB"></a>
<div id="GWUAD618" class="sect2">
<h3 class="sect2"><span class="secnum">17.3.6</span> Describing the Character Format</h3>
<p>The input parameter <code dir="ltr">column_value_mode</code> describes the character format of the data that is being processed and is used in several of the function codes. The following table describes the meaning of the <code dir="ltr">EXIT_FN_RAW_FORMAT</code>, <code dir="ltr">EXIT_FN_CHAR_FORMAT</code>, and <code dir="ltr">EXIT_FN_CNVTED_SESS_FORMAT</code> format codes, per data type.</p>
<div id="GWUAD619" class="tblhruleformalwide"><p class="titleintable"><a id="sthref957"></a><a id="sthref958"></a>Table 17-5 column_value_mode_matrix Meanings</p>
<table class="cellalignment160" title="column_value_mode_matrix Meanings" summary="This table shows the character format of the data that is being processed and used in several of the function codes.">
<thead>
<tr class="cellalignment151">
<th class="cellalignment161" id="r1c1-t12">Data Type</th>
<th class="cellalignment161" id="r1c2-t12">EXIT_FN_RAW_FORMAT</th>
<th class="cellalignment161" id="r1c3-t12">EXIT_FN_CHAR_FORMAT</th>
<th class="cellalignment161" id="r1c4-t12">EXIT_FN_CNVTED_SESS_FORMAT</th>
</tr>
</thead>
<tbody>
<tr class="cellalignment151">
<td class="cellalignment157" id="r2c1-t12" headers="r1c1-t12">
<p><code dir="ltr">CHAR</code></p>
<p><code dir="ltr">"abc</code>"</p>
</td>
<td class="cellalignment157" headers="r2c1-t12 r1c2-t12">
<p>2-byte null indicator +</p>
<p>2-byte length info</p>
<p>+ column value</p>
<p>0000 0004 61 62 63 20</p>
</td>
<td class="cellalignment157" headers="r2c1-t12 r1c3-t12">
<p>"abc" encoded in <code dir="ltr">ASCII</code> or <code dir="ltr">EBCDIC</code>.</p>
<p><code dir="ltr">NULL</code> terminated.</p>
<p>Tailing spaces are trimmed.</p>
</td>
<td class="cellalignment157" headers="r2c1-t12 r1c4-t12">
<p>"abc" encoded in user exit session character set.</p>
<p><code dir="ltr">NOT NULL</code> terminated.</p>
<p>Tailing spaces are trimmed by default unless the <code dir="ltr">GLOBALS</code> parameter <code dir="ltr">NOTRIMSPACES</code> is specified.</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r3c1-t12" headers="r1c1-t12">
<p><code dir="ltr">NCHAR</code></p>
<p><code dir="ltr">0061 0062 0063 0020</code></p>
</td>
<td class="cellalignment157" headers="r3c1-t12 r1c2-t12">
<p>2-byte null indicator +</p>
<p>2-byte length info +</p>
<p>column value.</p>
<p>0000 0008 00 61 0062 0063 0020</p>
</td>
<td class="cellalignment157" headers="r3c1-t12 r1c3-t12">
<p>"abc" (encoded in <code dir="ltr">UTF8</code>) or truncated at the first byte, depending on whether <code dir="ltr">NCHAR</code> is treated as UTF-8.</p>
<p><code dir="ltr">NULL</code> terminated.</p>
<p>Trailing spaces are trimmed.</p>
</td>
<td class="cellalignment157" headers="r3c1-t12 r1c4-t12">
<p>"abc" encoded in user exit session character set.</p>
<p><code dir="ltr">NOT NULL</code> terminated.</p>
<p>Tailing spaces are trimmed by default unless the <code dir="ltr">GLOBALS</code> parameter <code dir="ltr">NOTRIMSPACES</code> is specified.</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r4c1-t12" headers="r1c1-t12">
<p><code dir="ltr">VARCHAR2</code></p>
<p><code dir="ltr">"abc"</code></p>
</td>
<td class="cellalignment157" headers="r4c1-t12 r1c2-t12">
<p>2-byte null indicator +</p>
<p>2-byte length info +</p>
<p>column value</p>
</td>
<td class="cellalignment157" headers="r4c1-t12 r1c3-t12">
<p>"abc" encoded in <code dir="ltr">ASCII</code> or <code dir="ltr">EBCDIC</code>.</p>
<p><code dir="ltr">NULL</code> terminated.</p>
<p>No trimming.</p>
</td>
<td class="cellalignment157" headers="r4c1-t12 r1c4-t12">
<p>"abc" encoded in user exit session character set.</p>
<p><code dir="ltr">NOT NULL</code> terminated.</p>
<p>No trimming.</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r5c1-t12" headers="r1c1-t12">
<p><code dir="ltr">NVARCHAR2</code></p>
<p><code dir="ltr">0061 0062 0063 0020</code></p>
</td>
<td class="cellalignment157" headers="r5c1-t12 r1c2-t12">
<p>2-byte null indicator +</p>
<p>2-byte length info +</p>
<p>column value</p>
</td>
<td class="cellalignment157" headers="r5c1-t12 r1c3-t12">
<p>"abc" (encoded in <code dir="ltr">UTF8</code>) or truncated at the first byte, depending on whether <code dir="ltr">NVARCHAR2</code> is treated as <code dir="ltr">UTF-8</code>.</p>
<p><code dir="ltr">NULL</code> terminated.</p>
<p>No trimming.</p>
</td>
<td class="cellalignment157" headers="r5c1-t12 r1c4-t12">
<p>"abc"encoded in user exit session character set.</p>
<p><code dir="ltr">NOT NULL</code> terminated.</p>
<p>No trimming.</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r6c1-t12" headers="r1c1-t12">
<p><code dir="ltr">CLOB</code></p>
</td>
<td class="cellalignment157" headers="r6c1-t12 r1c2-t12">
<p>2-byte null indicator +</p>
<p>2-byte length info +</p>
<p>column value</p>
</td>
<td class="cellalignment157" headers="r6c1-t12 r1c3-t12">
<p>Similar to <code dir="ltr">VARCHAR2</code>, but only output up to 4K bytes.</p>
<p><code dir="ltr">NULL</code> Terminated.</p>
<p>No trimming.</p>
</td>
<td class="cellalignment157" headers="r6c1-t12 r1c4-t12">
<p>Similar to <code dir="ltr">VARCHAR2</code>, but only output data requested in user exit session character set.</p>
<p><code dir="ltr">NOT NULL</code> terminated.</p>
<p>No trimming.</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r7c1-t12" headers="r1c1-t12">
<p><code dir="ltr">NCLOB</code></p>
</td>
<td class="cellalignment157" headers="r7c1-t12 r1c2-t12">
<p>2-byte null indicator +</p>
<p>2-byte length info +</p>
<p>column value</p>
</td>
<td class="cellalignment157" headers="r7c1-t12 r1c3-t12">
<p>Similar to <code dir="ltr">NVARCHAR2</code>, but only output up to 4K bytes.</p>
<p><code dir="ltr">NULL</code> terminated.</p>
<p>No trimming.</p>
</td>
<td class="cellalignment157" headers="r7c1-t12 r1c4-t12">
<p>Similar to <code dir="ltr">NVARCHAR2</code>, but only output data requested in user exit session character set.</p>
<p><code dir="ltr">NOT NULL</code> terminated.</p>
<p>No trimming.</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r8c1-t12" headers="r1c1-t12">
<p><code dir="ltr">NUMBER</code></p>
<p><code dir="ltr">123.89</code></p>
</td>
<td class="cellalignment157" headers="r8c1-t12 r1c2-t12">
<p>2-byte null indicator +</p>
<p>2-byte length info +</p>
<p>column value</p>
</td>
<td class="cellalignment157" headers="r8c1-t12 r1c3-t12">
<p>"123.89" encoded in <code dir="ltr">ASCII</code> or <code dir="ltr">EBCDIC</code>.</p>
<p><code dir="ltr">NULL</code> terminated.</p>
</td>
<td class="cellalignment157" headers="r8c1-t12 r1c4-t12">
<p>"123.89" encoded in user exit session character set.</p>
<p><code dir="ltr">NOT NULL</code> terminated.</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r9c1-t12" headers="r1c1-t12">
<p><code dir="ltr">DATE</code></p>
<p><code dir="ltr">31-May-11</code></p>
</td>
<td class="cellalignment157" headers="r9c1-t12 r1c2-t12">
<p>2-byte null indicator +</p>
<p>2-byte length info +</p>
<p>column value</p>
</td>
<td class="cellalignment157" headers="r9c1-t12 r1c3-t12">
<p>"2011-05-31" encoded in <code dir="ltr">ASCII</code> or <code dir="ltr">EBCDIC</code>.</p>
<p><code dir="ltr">NULL</code> terminated.</p>
</td>
<td class="cellalignment157" headers="r9c1-t12 r1c4-t12">
<p>"2011-05-31" encoded in user exit session character set.</p>
<p><code dir="ltr">NOT NULL</code> terminated.</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r10c1-t12" headers="r1c1-t12">
<p><code dir="ltr">TIMESTAMP</code></p>
<p><code dir="ltr">31-May-11 12.00.00 AM</code></p>
</td>
<td class="cellalignment157" headers="r10c1-t12 r1c2-t12">
<p>2-byte null indicator +</p>
<p>2-byte length info +</p>
<p>column value</p>
</td>
<td class="cellalignment157" headers="r10c1-t12 r1c3-t12">
<p>"2011-05-31 12.00.00 AM" encoded in <code dir="ltr">ASCII</code> or <code dir="ltr">EBCDIC</code>.</p>
<p><code dir="ltr">NULL</code> terminated.</p>
</td>
<td class="cellalignment157" headers="r10c1-t12 r1c4-t12">
<p>"2011-05-31 12.00.00 AM" encoded in user exit session character set.</p>
<p><code dir="ltr">NOT NULL</code> terminated.</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r11c1-t12" headers="r1c1-t12">
<p><code dir="ltr">Interval Year to Month or Interval Day to Second</code></p>
</td>
<td class="cellalignment157" headers="r11c1-t12 r1c2-t12">
<p>2-byte null indicator +</p>
<p>2-byte length info +</p>
<p>column value</p>
</td>
<td class="cellalignment157" headers="r11c1-t12 r1c3-t12">
<p>NA</p>
</td>
<td class="cellalignment157" headers="r11c1-t12 r1c4-t12">
<p>NA</p>
</td>
</tr>
<tr class="cellalignment151">
<td class="cellalignment157" id="r12c1-t12" headers="r1c1-t12">
<p><code dir="ltr">RAW</code></p>
</td>
<td class="cellalignment157" headers="r12c1-t12 r1c2-t12">
<p>2-byte null indicator +</p>
<p>2-byte length info +</p>
<p>column value</p>
</td>
<td class="cellalignment157" headers="r12c1-t12 r1c3-t12">
<p>2-byte null indicator +</p>
<p>2-byte length info +</p>
<p>column value</p>
</td>
<td class="cellalignment157" headers="r12c1-t12 r1c4-t12">
<p>2-byte null indicator +</p>
<p>2-byte length info +</p>
<p>column value</p>
</td>
</tr>
</tbody>
</table>
<br /></div>
<!-- class="tblhruleformalwide" --></div>
<!-- class="sect2" -->
<a id="CHDFCHID"></a>
<div id="GWUAD620" class="sect2">
<h3 class="sect2"><span class="secnum">17.3.7</span> Upgrading User Exits</h3>
<p>The <code dir="ltr">usrdecs.h</code> file is versioned to allow backward compatibility with existing user exits when enhancements or upgrades, such as new functions or structural changes, are added to a new Oracle GoldenGate release. The version of the <code dir="ltr">usrdecs.h</code> file is printed in the report file at the startup of Replicat or Extract.</p>
<p>To use new user exit functionality, you must recompile your routines to include the new <code dir="ltr">usrdecs</code> file. Routines that do not use new features do not need to be recompiled.</p>
</div>
<!-- class="sect2" -->
<a id="CHDDECCG"></a>
<div id="GWUAD621" class="sect2">
<h3 class="sect2"><span class="secnum">17.3.8</span> Viewing Examples of How to Use the User Exit Functions</h3>
<p>Oracle GoldenGate installs the following sample user exit files into the <code dir="ltr">UserExitExamples</code> directory of the Oracle GoldenGate installation directory:</p>
<ul>
<li>
<p><code dir="ltr">exitdemo.c</code> shows how to initialize the user exit, issue callbacks at given exit points, and modify data. It also demonstrates how to retrieve the fully qualified table name or a specific metadata part, such as the name of the catalog or container, or the schema, or just the unqualified table name. In addition, this demo shows how to process DDL data. The demo is not specific to any database type.</p>
</li>
<li>
<p><code dir="ltr">exitdemo_utf16.c</code> shows how to use UTF16-encoded data (both metadata and column data) in the callback structures for information exchanged between the user exit and the caller process.</p>
</li>
<li>
<p><code dir="ltr">exitdemo_passthru.c</code> shows how the <code dir="ltr">PASSTHRU</code> option of the <code dir="ltr">CUSEREXIT</code> parameter can be used in an Extract data pump.</p>
</li>
<li>
<p><code dir="ltr">exitdemo_more_recs.c</code> shows an example of how to use the same input record multiple times to generate several target records.</p>
</li>
<li>
<p><code dir="ltr">exitdemo_lob.c</code> shows an example of how to get read access to LOB data.</p>
</li>
<li>
<p><code dir="ltr">exitdemo_pk_befores.c</code> shows how to access the before and after image portions of a primary key update record, as well as the before images of regular updates (non-key updates). It also shows how to get target row values with <code dir="ltr">SQLEXEC</code> in the Replicat parameter file as a means for conflict detection. The resulting fetched values from the target are mapped as the target record when it enters the user exit.</p>
</li>
</ul>
<p>Each directory contains the <code dir="ltr">*.c</code> files as well as makefiles and a <code dir="ltr">readme.txt</code> file.</p>
</div>
<!-- class="sect2" --></div>
<!-- class="sect1" -->
<a id="i1047744"></a>
<div id="GWUAD622" class="sect1">
<h2 class="sect1"><span class="secnum">17.4</span> Using the Oracle GoldenGate <a id="sthref959"></a><a id="sthref960"></a><a id="sthref961"></a><a id="sthref962"></a>Event Marker System to Raise Database Events</h2>
<p>Oracle GoldenGate provides an event marker system, also known as the event marker infrastructure (EMI), which enables the Oracle GoldenGate processes to take a defined action based on an <span class="italic">event record</span> in the transaction log or in the trail (depending on the data source of the process). The event record is a record that satisfies a specific filter criterion for which you want an action to occur. You can use this system to customize Oracle GoldenGate processing based on database events.</p>
<p>For example, you can use the event marker system to start, suspend, or stop a process, to perform a transformation, or to report statistics. The event marker system can be put to use for purposes such as:</p>
<ul>
<li>
<p>To establish a synchronization point at which <code dir="ltr">SQLEXEC</code> or user exit functions can be performed</p>
</li>
<li>
<p>To execute a shell command that executes a data validation script or sends an email</p>
</li>
<li>
<p>To activate tracing when a specific account number is detected</p>
</li>
<li>
<p>To capture lag history</p>
</li>
<li>
<p>To stop or suspend a process to run reports or batch processes at the end of the day</p>
</li>
</ul>
<p>The event marker feature is supported for the replication of data changes, but not for initial loads.</p>
<p>The system requires the following input components:</p>
<ol>
<li>
<p>The <span class="italic">event record</span> that triggers the action can be specified with <code dir="ltr">FILTER</code>, <code dir="ltr">WHERE</code>, or <code dir="ltr">SQLEXEC</code> in a <code dir="ltr">TABLE</code> or <code dir="ltr">MAP</code> statement. Alternatively, a special <code dir="ltr">TABLE</code> statement in a Replicat parameter file enables you to perform <code dir="ltr">EVENTACTIONS</code> actions without mapping a source table to a target table.</p>
</li>
<li>
<p>In the <code dir="ltr">TABLE</code> or <code dir="ltr">MAP</code> statement where you specify the event record, include the <code dir="ltr">EVENTACTIONS</code> parameter with the appropriate option to specify the action that is to be taken by the process.</p>
</li>
</ol>
<p>You can combine <code dir="ltr">EVENTACTIONS</code> options, as shown in the following examples.</p>
<p>The following causes the process to issue a checkpoint, log an informational message, and ignore the entire transaction (without processing any of it), plus generate a report.</p>
<pre dir="ltr">
EVENTACTIONS (CP BEFORE, REPORT, LOG, <a id="sthref963"></a>IGNORE TRANSACTION)
</pre>
<p>The following writes the event record to the discard file and ignores the entire transaction.</p>
<pre dir="ltr">
EVENTACTIONS (<a id="sthref964"></a>DISCARD, IGNORE TRANS)
</pre>
<p>The following logs an informational message and gracefully stop the process.</p>
<pre dir="ltr">
EVENTACTIONS (LOG INFO, STOP)
</pre>
<p>The following rolls over the trail file and does not write the event record to the new file.</p>
<pre dir="ltr">
EVENTACTIONS (ROLLOVER, IGNORE)
</pre>
<p>For syntax details and additional usage instructions, see <a class="olink GWURF546" href="../../gg-winux/GWURF/gg_parameters160.htm#GWURF546"><span class="italic">Reference for Oracle GoldenGate for Windows and UNIX</span></a>.</p>
<a id="i1048461"></a>
<div id="GWUAD623" class="sect2">
<h3 class="sect2"><span class="secnum">17.4.1</span> Case Studies in the Usage of the Event Marker System</h3>
<p>These examples highlight some use cases for the event marker system. For syntax details and additional usage instructions, see <a class="olink GWURF546" href="../../gg-winux/GWURF/gg_parameters160.htm#GWURF546"><span class="italic">Reference for Oracle GoldenGate for Windows and UNIX</span></a>.</p>
<div id="GWUAD624" class="sect3"><a id="sthref965"></a>
<h4 class="sect3"><span class="secnum">17.4.1.1</span> Trigger End-of-day Processing</h4>
<p>This example specifies the capture of operations that are performed on a special table named <code dir="ltr">event_table</code> in the source database. This table exists solely for the purpose of receiving inserts at a predetermined time, for example at 5:00 P.M. every day. When Replicat receives the transaction record for this operation, it stops gracefully to allow operators to start end-of-day processing jobs. By using the insert on the <code dir="ltr">event_table</code> table every day, the operators know that Replicat has applied all committed transactions up to 5:00. <code dir="ltr">IGNORE</code> causes Replicat to ignore the event record itself, because it has no purpose in the target database. <code dir="ltr">LOG INFO</code> causes Replicat to log an informational message about the operation.</p>
<pre dir="ltr">
TABLE source.event_table, EVENTACTIONS (IGNORE, LOG INFO, STOP);
</pre></div>
<!-- class="sect3" -->
<div id="GWUAD625" class="sect3"><a id="sthref966"></a>
<h4 class="sect3"><span class="secnum">17.4.1.2</span> Simplify Transition from Initial Load to Change Synchronization</h4>
<p>Event actions and event tables can be used to help with the transition from an initial load to ongoing change replication. For example, suppose an existing, populated source table must be added to the Oracle GoldenGate configuration. This table must be created on the target, and then the two must be synchronized by using an export/import. This example assumes that an event table named <code dir="ltr">source.event_table</code> exists in the source database and is specified in a Replicat <code dir="ltr">TABLE</code> statement.</p>
<pre dir="ltr">
TABLE source.event_table, EVENTACTIONS (IGNORE, LOG INFO, STOP);
</pre>
<p>To allow users to continue working with the new source table, it is added to the Extract parameter file, but not to the Replicat parameter file. Extract begins capturing data from this table to the trail, where it is stored.</p>
<p>At the point where the source and target are read-consistent after the export, an event record is inserted into the event table on the source, which propagates to the target. When Replicat receives the event record (marking the read-consistent point), the process stops as directed by <code dir="ltr">EVENTACTIONS STOP</code>. This allows the new table to be added to the Replicat <code dir="ltr">MAP</code> statement. Replicat can be positioned to start replication from the timestamp of the event record, eliminating the need to use the <code dir="ltr">HANDLECOLLISIONS</code> parameter. Operations in the trail from before the event record can be ignored because it is known that they were applied in the export.</p>
<p>The event record itself is ignored by Replicat, but an informational message is logged.</p>
</div>
<!-- class="sect3" -->
<div id="GWUAD626" class="sect3"><a id="sthref967"></a>
<h4 class="sect3"><span class="secnum">17.4.1.3</span> Stop Processing When Data Anomalies are Encountered</h4>
<p>This example uses <code dir="ltr">ABORT</code> to stop Replicat immediately with a fatal error if an anomaly is detected in a bank record, where the customer withdraws more money than the account contains. In this case, the source table is mapped to a target table in a Replicat <code dir="ltr">MAP</code> statement for actual replication to the target. A <code dir="ltr">TABLE</code> statement is also used for the source table, so that the <code dir="ltr">ABORT</code> action stops Replicat before it applies the anomaly to the target database. <code dir="ltr">ABORT</code> takes precedence over processing the record.</p>
<pre dir="ltr">
MAP source.account, TARGET target.account;
TABLE source.account, FILTER (withdrawal &gt; balance), EVENTACTIONS (ABORT);
</pre></div>
<!-- class="sect3" -->
<div id="GWUAD627" class="sect3"><a id="sthref968"></a>
<h4 class="sect3"><span class="secnum">17.4.1.4</span> Use a Heartbeat Table and Logging to Analyze <a id="sthref969"></a>Lag</h4>
<p>This example shows how to configure log actions. A <code dir="ltr">heartbeat</code> table is periodically updated with the current time in the source database. The updates to the <code dir="ltr">heartbeat</code> table are captured and written to the trail by Extract. Using the heartbeat record as the event record, Replicat logs messages based on lag calculations in two different <code dir="ltr">MAP</code> statements with <code dir="ltr">FILTER</code> clauses.</p>
<pre dir="ltr">
ALLOWDUPTARGETMAPS
MAP source.heartbeat, TARGET target.heartbeat, &amp;
FILTER ( &amp;
@DATEDIFF ('SS', hb_timestamp, @DATENOW ()) &gt; 60 AND &amp;
@DATEDIFF ('SS', hb_timestamp, @DATENOW ()) &lt; 120), &amp;
EVENTACTIONS (LOG INFO);
MAP source.heartbeat, TARGET target.heartbeat, &amp;
FILTER (@DATEDIFF ('SS', hb_timestamp, @DATENOW ()) &gt; 120), &amp;
EVENTACTIONS (LOG <a id="sthref970"></a>WARNING);
</pre>
<p>In the first <code dir="ltr">FILTER</code> clause, an informational message is written if the lag exceeds 60 seconds but is less than 120 seconds. In the second <code dir="ltr">FILTER</code> clause, a warning message is logged if the lag exceeds 120 seconds.</p>
<p>In this example, the heartbeat record is also written to a <code dir="ltr">heartbeat</code> audit table in the target database, which can be used for historical lag analysis. An alternate option would be to <code dir="ltr">IGNORE</code> or <code dir="ltr">DISCARD</code> the heartbeat record.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
<code dir="ltr">ALLOWDUPTARGETMAPS</code> is used because there are duplicate <code dir="ltr">MAP</code> statements for the same source and target objects.</div>
</div>
<!-- class="sect3" -->
<div id="GWUAD628" class="sect3"><a id="sthref971"></a>
<h4 class="sect3"><span class="secnum">17.4.1.5</span> Trace a Specific Order Number</h4>
<p>The following example enables Replicat tracing only for an order transaction that contains an insert operation for a specific order number (<code dir="ltr">order_no = 1</code>). The trace information is written to the <code dir="ltr">order_1.trc</code> trace file. The <code dir="ltr">MAP</code> parameter specifies the mapping of the source table to the target table.</p>
<pre dir="ltr">
MAP sales.order, TARGET rpt.order;
TABLE source.order,
FILTER (@GETENV ('GGHEADER', 'OPTYPE') = 'INSERT' AND order_no = 1), &amp;
EVENTACTIONS (TRACE order_1.trc TRANSACTION);
</pre></div>
<!-- class="sect3" -->
<div id="GWUAD629" class="sect3"><a id="sthref972"></a>
<h4 class="sect3"><span class="secnum">17.4.1.6</span> Execute a Batch Process</h4>
<p>In this example, a batch process executes once a month to clear the source database of accumulated data. At the beginning of the transaction, typically a batch transaction, a record is written to a special <code dir="ltr">job</code> table to indicate that the batch job is starting. <code dir="ltr">TRANSACTION</code> is used with <code dir="ltr">IGNORE</code> to specify that the entire transaction must be ignored by Extract, because the target system does not need to reflect the deleted records. By ignoring the work on the Extract side, unnecessary trail and network overhead is eliminated.</p>
<pre dir="ltr">
TABLE source.job, FILTER (@streq (job_type = 'HOUSEKEEPING')=1), &amp;
EVENTACTIONS (IGNORE TRANSACTION);
</pre>
<div class="infobox-note">
<p class="notep1">Note:</p>
If a logical batch delete were to be composed of multiple smaller batches, each smaller batch would require an insert into the job table as the first record in the transaction.</div>
</div>
<!-- class="sect3" -->
<div id="GWUAD630" class="sect3"><a id="sthref973"></a>
<h4 class="sect3"><span class="secnum">17.4.1.7</span> Propagate Only a SQL Statement without the Resultant Operations</h4>
<p>This example shows how different <code dir="ltr">EVENTACTIONS</code> clauses can be used in combination on the source and target to replicate just a SQL statement rather than the operations that result from that statement. In this case, it is an <code dir="ltr">INSERT INTO...SELECT</code> transaction. Such a transaction could generate millions of rows that would need to be propagated, but with this method, all that is propagated is the initial SQL statement to reduce trail and network overhead. The <code dir="ltr">SELECTs</code> are all performed on the target. This configuration requires perfectly synchronized source and target tables in order to maintain data integrity.</p>
<p>Extract:</p>
<pre dir="ltr">
TABLE source.statement, EVENTACTIONS (IGNORE TRANS INCLUDEEVENT);
</pre>
<p>Replicat:</p>
<pre dir="ltr">
TABLE source.statement, SQLEXEC (execute SQL statement), &amp;
EVENTACTIONS (INFO, IGNORE);
</pre>
<p>To use this configuration, a <code dir="ltr">statement</code> table is populated with the first operation in the transaction, that being the <code dir="ltr">INSERT INTO...SELECT</code>, which becomes the event record.</p>
<div class="infobox-note">
<p class="notep1">Note:</p>
For large SQL statements, the statement can be written to multiple columns in the table. For example, eight <code dir="ltr">VARCHAR (4000)</code> columns could be used to store SQL statements up to 32 KB in length.</div>
<p>Because of the <code dir="ltr">IGNORE TRANS INCLUDEEVENT</code>, Extract ignores all of the subsequent inserts that are associated with the <code dir="ltr">SELECT</code> portion of the statement, but writes the event record that contains the SQL text to the trail. Using a <code dir="ltr">TABLE</code> statement, Replicat passes the event record to a <code dir="ltr">SQLEXEC</code> statement that concatenates the SQL text columns, if necessary, and executes the <code dir="ltr">INSERT INTO...SELECT</code> statement using the target tables as the input for the <code dir="ltr">SELECT</code> sub-query.</p>
</div>
<!-- class="sect3" -->
<div id="GWUAD631" class="sect3"><a id="sthref974"></a>
<h4 class="sect3"><span class="secnum">17.4.1.8</span> Committing Other Transactions Before Starting a Long-running Transaction</h4>
<p>This use of <code dir="ltr">EVENTACTIONS</code> ensures that all open transactions that are being processed by Replicat get committed to the target before the start of a long running transaction. It forces Replicat to write a checkpoint before beginning work on the large transaction. Forcing a checkpoint constrains any potential recovery to just the long running transaction. Because a Replicat checkpoint implies a commit to the database, it frees any outstanding locks and makes the pending changes visible to other sessions.</p>
<pre dir="ltr">
TABLE source.batch_table, EVENTACTIONS (CHECKPOINT BEFORE);
</pre></div>
<!-- class="sect3" -->
<div id="GWUAD632" class="sect3"><a id="sthref975"></a>
<h4 class="sect3"><span class="secnum">17.4.1.9</span> Execute a Shell Script to Validate Data</h4>
<p>This example executes a shell script that runs another script that validates data after Replicat applies the last transaction in a test run. On the source, an event record is written to an event table named <code dir="ltr">source.event</code>. The record inserts the value <code dir="ltr">COMPARE</code> into the <code dir="ltr">event_type</code> column of the event table, and this record gets replicated at the end of the other test data. In the <code dir="ltr">TABLE</code> statement in the Replicat parameter file, the <code dir="ltr">FILTER</code> clause qualifies the record and then triggers the shell script <code dir="ltr">compare_db.sh</code> to run as specified by <code dir="ltr">SHELL</code> in the <code dir="ltr">EVENTACTIONS</code> clause. After that, Replicat stops immediately as specified by <code dir="ltr">FORCESTOP</code>.</p>
<p>Extract:</p>
<pre dir="ltr">
TABLE src.*;
TABLE test.event;
</pre>
<p>Replicat:</p>
<pre dir="ltr">
MAP src.*, TARGET targ.*;
MAP test.event, TARGET test.event, FILTER (@streq (event_type, 'COMPARE')=1), &amp;
EVENTACTIONS (SHELL 'compare_db.sh', FORCESTOP);
</pre></div>
<!-- class="sect3" --></div>
<!-- class="sect2" --></div>
<!-- class="sect1" --></div>
<!-- class="chapter" --></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment150">
<tr>
<td class="cellalignment157"><table class="cellalignment155">
<tr>
<td class="cellalignment154"><a href="wu_initsync.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>

<td class="cellalignment154"><a href="wu_monitoring.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table></td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2013, 2014,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment159">
<table class="cellalignment153">
<tr>
<td class="cellalignment154"><a href="../../index.html"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment154"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment154"><a href="index.htm"><img width="24" height="24" src="../../dcommon/gifs/index.gif" alt="Go to Index" /><br />
<span class="icon">Index</span></a></td>
<td class="cellalignment154"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
