<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml/DTD/xhtml1-transitional.dtd">
<html lang="en">
<head>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>SQLEXEC</title>
<meta name="generator" content="Oracle DARB XHTML Converter (Mode = document) - Merged Version 1056" />
<meta name="description" content="Contains instructions for using Oracle GoldenGate commands, parameters, and functions." />
<meta name="dcterms.created" content="2015-06-05T16:34:26Z" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
<meta name="robots" content="all" />
<meta name="dcterms.title" content="Oracle&reg; GoldenGate Reference for Oracle GoldenGate for Windows and UNIX" />
<meta name="dcterms.identifier" content="E29392-08" />
<meta name="dcterms.isVersionOf" content="GWURF" />
<link rel="Start" href="../../index.html" title="Home" type="text/html" />
<link rel="Copyright" href="../../dcommon/html/cpyr.htm" title="Copyright" type="text/html" />

<script type="application/javascript"  src="../../dcommon/js/headfoot.js"></script>
<script type="application/javascript"  src="../../nav/js/doccd.js"></script>
<link rel="Contents" href="toc.htm" title="Contents" type="text/html" />
<link rel="Prev" href="gg_parameters155.htm" title="Previous" type="text/html" />
<link rel="Next" href="gg_parameters157.htm" title="Next" type="text/html" />
<link rel="alternate" href="../GWURF.pdf" title="PDF version" type="application/pdf" />
<link rel="alternate" href="../GWURF.epub" title="ePub version" type="application/epub+zip" />
<link rel="alternate" href="../GWURF.mobi" title="Mobipocket version" type="application/x-mobipocket-ebook" />
<link rel="schema.dcterms" href="http://purl.org/dc/terms/" />
<link rel="stylesheet" href="../../dcommon/css/fusiondoc.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/header.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/footer.css">
<link rel="stylesheet" type="text/css"  href="../../dcommon/css/fonts.css">
<link rel="stylesheet" href="../../dcommon/css/foundation.css">
<link rel="stylesheet" href="../../dcommon/css/codemirror.css">
<link rel="stylesheet" type="text/css" title="Default" href="../nav/css/html5.css">
<link rel="stylesheet" href="../../dcommon/css/respond-480-tablet.css">
<link rel="stylesheet" href="../../dcommon/css/respond-768-laptop.css">
<link rel="stylesheet" href="../../dcommon/css/respond-1140-deskop.css">
<script type="application/javascript" src="../../dcommon/js/modernizr.js"></script>
<script type="application/javascript" src="../../dcommon/js/codemirror.js"></script>
<script type="application/javascript" src="../../dcommon/js/jquery.js"></script>
<script type="application/javascript" src="../../dcommon/js/foundation.min.js"></script>
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-552992c80ef99c8d" async="async"></script>
<script type="application/javascript" src="../../dcommon/js/jqfns.js"></script>
<script type="application/javascript" src="../../dcommon/js/ohc-inline-videos.js"></script>
<!-- Add fancyBox -->
<link rel="stylesheet" href="../../dcommon/fancybox/jquery.fancybox.css?v=2.1.5" type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/jquery.fancybox.pack.js?v=2.1.5"></script>
<!-- Optionally add helpers - button, thumbnail and/or media -->
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.css?v=1.0.5"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-buttons.js?v=1.0.5"></script>
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-media.js?v=1.0.6"></script>
<link rel="stylesheet"  href="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.css?v=1.0.7"  type="text/css" media="screen" />
<script type="text/javascript" src="../../dcommon/fancybox/helpers/jquery.fancybox-thumbs.js?v=1.0.7"></script>
<script>window.ohcglobal || document.write('<script src="/en/dcommon/js/global.js">\x3C/script>')</script></head>
<body>
<header><!--
<div class="zz-skip-header"><a id="top" href="#BEGIN">Skip Headers</a>--></header>
<div class="row" id="CONTENT">
<div class="IND large-9 medium-8 columns"><div id="BREADCRUMBS"><a href="http://docs.oracle.com">Home</a> / <a href="../../index.html">Middleware</a> / <a href="../index.html">Oracle GoldenGate for Windows and UNIX</a>
</div>

<span id="PAGE" style="display:none;">272/413</span>
<!-- End Header --><a id="i2640121"></a>
<div id="GWURF660" class="refsect1">
<h1 class="refsect1">SQLEXEC</h1>
<div class="refsubsect"><p class="titleinrefsubsect"><a id="sthref1421"></a>Valid For</p>
<p>Extract and Replicat</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect"><p class="titleinrefsubsect"><a id="sthref1422"></a>Description</p>
<p>Use the <code dir="ltr">SQLEXEC</code> parameter to execute a stored procedure, query, or database command within the context of Oracle GoldenGate processing. <code dir="ltr">SQLEXEC</code> enables Oracle GoldenGate to communicate directly with the database to perform any work that is supported by the database. This work can be part of the synchronization process, such as retrieving values for column conversion, or it can be independent of extracting or replicating data, such as executing a stored procedure that executes an action within the database</p>
<p><code dir="ltr">SQLEXEC</code> works as follows:</p>
<ul>
<li>
<p>As a standalone statement at the root level of a parameter file to execute a SQL stored procedure or query or to execute a database command. As a standalone statement, <code dir="ltr">SQLEXEC</code> executes independently of a <code dir="ltr">TABLE</code> or <code dir="ltr">MAP</code> statement during Oracle GoldenGate processing. When used in a standalone <code dir="ltr">SQLEXEC</code> parameter, a query or procedure cannot include parameters. See <a href="#BABHACGI">"Standalone SQLEXEC"</a>.</p>
</li>
<li>
<p>As part of a <code dir="ltr">TABLE</code> or <code dir="ltr">MAP</code> parameter to execute a stored procedure or query with or without parameters. When used with parameters, the procedure or query that is executed can accept input parameters from source or target rows and pass output parameters. See <a href="#BABICGDA">"SQLEXEC in a TABLE or MAP Parameter"</a>.</p>
</li>
</ul>
</div>
<!-- class="refsubsect" -->
<div class="infobox-note">
<p class="notep1">Caution:</p>
Use caution when executing <code dir="ltr">SQLEXEC</code> procedures against the database, especially against the production database. Any changes that are committed by the procedure can result in overwriting existing data.</div>
<div class="refsubsect"><p class="titleinrefsubsect"><a id="BABHACGI"></a>Standalone SQLEXEC</p>
<p>A standalone <code dir="ltr">SQLEXEC</code> parameter is one that is used at the root level of a parameter file and acts independently of a <code dir="ltr">TABLE</code> or <code dir="ltr">MAP</code> parameter. The following are guidelines for using a standalone <code dir="ltr">SQLEXEC</code> parameter.</p>
<ul>
<li>
<p>A standalone <code dir="ltr">SQLEXEC</code> statement executes in the order in which it appears in the parameter file relative to other parameters.</p>
</li>
<li>
<p>A <code dir="ltr">SQLEXEC</code> procedure or query must contain all exception handling.</p>
</li>
<li>
<p>A query or procedure must be structured correctly when executing a <code dir="ltr">SQLEXEC</code> statement, with legal SQL syntax for the database; otherwise Replicat will abend, regardless of any error-handling rules that are in place. Refer to the SQL reference guide provided by the database vendor for permissible SQL syntax.</p>
</li>
<li>
<p>A database credential for the Oracle GoldenGate user must precede the <code dir="ltr">SQLEXEC</code> clause. For Extract, use the <code dir="ltr">SOURCEDB</code> and <code dir="ltr">USERID</code> or <code dir="ltr">USERIDALIAS</code> parameters as appropriate for the database. For Replicat, use the <code dir="ltr">TARGETDB</code> and <code dir="ltr">USERID</code> or <code dir="ltr">USERIDALIAS</code> parameters, as appropriate.</p>
</li>
<li>
<p>The database credential that the Oracle GoldenGate process uses is the one that executes the SQL. This credential must have the privilege to execute commands and stored procedures and call database-supplied procedures.</p>
</li>
<li>
<p>A standalone <code dir="ltr">SQLEXEC</code> statement cannot be used to get input parameters from records or pass output parameters. You can use stored procedures and queries with parameters by using a <code dir="ltr">SQLEXEC</code> statement within a <code dir="ltr">TABLE</code> or <code dir="ltr">MAP</code> statement. See <a href="#BABICGDA">"SQLEXEC in a TABLE or MAP Parameter"</a>.</p>
</li>
<li>
<p>All objects affected by a standalone <code dir="ltr">SQLEXEC</code> statement must exist before the Oracle GoldenGate processes start. Because of this, DDL support must be disabled for those objects; otherwise, DDL operations could change the structure of, or delete an object, before the <code dir="ltr">SQLEXEC</code> procedure or query executes on it.</p>
</li>
<li>
<p>Object names must be fully qualified in their two-part or three-part name format.</p>
</li>
<li>
<p>For DB2 on z/OS, Oracle GoldenGate uses the ODBC <code dir="ltr">SQLExecDirect</code> function to execute a SQL statement dynamically. ODBC prepares the SQL statement every time that it is executed, at a specified interval. To support this function, the connected database server must be configured to prepare SQL dynamically. See the DB2 for z/OS documentation for more information.</p>
</li>
</ul>
<div class="refsubsect"><p class="titleinrefsubsect2"><a id="sthref1423"></a>Getting More Information about Using Standalone SQLEXEC</p>
<p>See <a class="olink GWUAD574" href="../../gg-winux/GWUAD/wu_customcode.htm#GWUAD574"><span class="italic">Administering Oracle GoldenGate for Windows and UNIX</span></a> for more information about how to use <code dir="ltr">SQLEXEC</code>.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect"><p class="titleinrefsubsect2"><a id="sthref1424"></a>Syntax for Standalone SQLEXEC</p>
<pre dir="ltr">
SQLEXEC 
{'call <span class="italic">procedure_name</span>()' | '<span class="italic">SQL_query</span>' | '<span class="italic">database_command</span>'}
[EVERY <span class="italic">n</span> {SECONDS | MINUTES | HOURS | DAYS}]
[ONEXIT]
[, THREADS (<span class="codeinlineitalic">threadID</span>[, <span class="codeinlineitalic">threadID</span>][, ...][, <span class="codeinlineitalic">thread_range</span>[, <span class="codeinlineitalic">thread_range</span>][, ...])]
</pre>
<dl>
<dt><code dir="ltr">'call</code> <code dir="ltr"><span class="codeinlineitalic">procedure_name ()'</span></code></dt>
<dd>
<p>Specifies the name of a stored procedure to execute. Enclose the statement within single quotes. The <code dir="ltr">call</code> keyword is required. The following is an example of how to execute a procedure with standalone <code dir="ltr">SQLEXEC</code>:</p>
<pre dir="ltr">
SQLEXEC 'call prc_job_count ()'
</pre></dd>
<dt><code dir="ltr"><span class="codeinlineitalic">'SQL_query'</span></code></dt>
<dd>
<p>Specifies the name of a query to execute. Enclose the query within single quotes. Specify case-sensitive object names in the same format required by the database. The following is an example of how to execute a query with standalone <code dir="ltr">SQLEXEC</code>:</p>
<pre dir="ltr">
SQLEXEC ' select x from dual '
</pre>
<p>For a multi-line query, use the single quotes on each line. For best results, type a space after each begin quote and before each end quote (or at least before each end quote).</p>
</dd>
<dt><code dir="ltr"><span class="codeinlineitalic">'database_command'</span></code></dt>
<dd>
<p>Executes a database command. The following is an example of how to execute a database command with standalone <code dir="ltr">SQLEXEC</code>:</p>
<pre dir="ltr">
SQLEXEC 'SET TRIGGERS OFF'
</pre></dd>
<dt><code dir="ltr">EVERY</code> <code dir="ltr"><span class="codeinlineitalic">n</span></code> <code dir="ltr">{SECONDS | MINUTES | HOURS | DAYS}</code></dt>
<dd>
<p>Causes a standalone stored procedure or query to execute at a defined interval, for example:</p>
<pre dir="ltr">
SQLEXEC 'call prc_job_count ()' EVERY 30 SECONDS
</pre>
<p>The interval must be a whole, positive integer.</p>
</dd>
<dt><code dir="ltr">ONEXIT</code></dt>
<dd>
<p>Executes the SQL when the Extract or Replicat process stops gracefully, for example:</p>
<pre dir="ltr">
SQLEXEC 'call prc_job_count ()' ONEXIT
</pre></dd>
<dt><code dir="ltr">THREADS (</code><code dir="ltr"><span class="codeinlineitalic">threadID</span></code><code dir="ltr">[,</code> <code dir="ltr"><span class="codeinlineitalic">threadID</span></code><code dir="ltr">][, ...][,</code> <code dir="ltr"><span class="codeinlineitalic">thread_range</span></code><code dir="ltr">[,</code> <code dir="ltr"><span class="codeinlineitalic">thread_range</span></code><code dir="ltr">][, ...]</code><code dir="ltr">)</code></dt>
<dd>
<p>Executes <code dir="ltr">SQLEXEC</code> only for the specified thread or threads of a coordinated Replicat.</p>
<dl>
<dt><code dir="ltr"><span class="codeinlineitalic">threadID</span></code><code dir="ltr">[,</code> <code dir="ltr"><span class="codeinlineitalic">threadID</span></code><code dir="ltr">][, ...]</code></dt>
<dd>
<p>Specifies a thread ID or a comma-delimited list of threads in the format of <code dir="ltr">threadID, threadID, threadID</code>.</p>
</dd>
<dt><code dir="ltr">[,</code> <code dir="ltr"><span class="codeinlineitalic">thread_range</span></code><code dir="ltr">[,</code> <code dir="ltr"><span class="codeinlineitalic">thread_range</span></code><code dir="ltr">][, ...]</code></dt>
<dd>
<p>Specifies a range of threads in the form of <code dir="ltr">threadIDlow-threadIDhigh</code> or a comma-delimted list of ranges in the format of <code dir="ltr">threadIDlow-threadIDhigh</code>, <code dir="ltr">threadIDlow-threadIDhigh</code>.</p>
</dd>
</dl>
<p>A combination of these formats is permitted, such as threadID, threadID, <code dir="ltr">threadIDlow-threadIDhigh</code>.</p>
</dd>
</dl>
<p>If no <code dir="ltr">THREADS</code> clause is used, the SQL is executed by all of the threads that were configured for this Replicat group by the <code dir="ltr">ADD REPLICAT</code> command. However, if the SQL satisfies the criteria for a barrier transaction, the entire <code dir="ltr">SQLEXEC</code> statement is processed by thread 0 regardless of the actual thread mapping.</p>
</div>
<!-- class="refsubsect" --></div>
<!-- class="refsubsect" -->
<div class="refsubsect"><p class="titleinrefsubsect"><a id="BABICGDA"></a>SQLEXEC in a TABLE or MAP Parameter</p>
<p>A <code dir="ltr">SQLEXEC</code> parameter in a <code dir="ltr">TABLE</code> or <code dir="ltr">MAP</code> parameter can be used to execute a stored procedure or query that does or does not accept parameters. The following are <code dir="ltr">SQLEXEC</code> dependencies and restrictions when used in a <code dir="ltr">MAP</code> or <code dir="ltr">TABLE</code> statement:</p>
<ul>
<li>
<p>The SQL is executed by the database user under which the Oracle GoldenGate process is running. This user must have the privilege to execute stored procedures and call database-supplied procedures.</p>
</li>
<li>
<p>A query or procedure must be structured correctly when executing a <code dir="ltr">SQLEXEC</code> statement. If Replicat encounters a problem with the query or procedure, the process abends immediately, despite any error-handling rules that are in place. Refer to the SQL reference guide provided by the database vendor for permissible SQL syntax.</p>
</li>
<li>
<p>The <code dir="ltr">COMMIT</code> operation of a Replicat transaction to the target database also commits any DML changes that are made in a <code dir="ltr">SQLEXEC</code> statement within the boundary of the original source transaction. This is not true for Extract, because Extract does not perform SQL transactions. When using <code dir="ltr">SQLEXEC</code> for Extract, you can either enable implicit commits or execute an explicit commit within the <code dir="ltr">SQLEXEC</code> procedure.</p>
</li>
<li>
<p>Specify literals in single quotes. Specify case-sensitive object names the same way they are specified in the database.</p>
</li>
<li>
<p>Do not use <code dir="ltr">SQLEXEC</code> to change the value of a primary key column. The primary key value is passed from Extract to Replicat. Without it, Replicat operations cannot be completed. If primary key values must be changed with <code dir="ltr">SQLEXEC</code>, you may be able to avoid errors by mapping the original key value to another column and then defining that column as a substitute key with the <code dir="ltr">KEYCOLS</code> option of the <code dir="ltr">TABLE</code> and <code dir="ltr">MAP</code> parameters.</p>
</li>
<li>
<p>For DB2 on z/OS, Oracle GoldenGate uses the ODBC <code dir="ltr">SQLExecDirect</code> function to execute a SQL statement dynamically. ODBC prepares the SQL statement every time that it is executed, at a specified interval. To support this function, the connected database server must be configured to prepare SQL dynamically. See the DB2 for z/OS documentation for more information.</p>
</li>
<li>
<p>When using Oracle GoldenGate to replicate DDL, all objects that are affected by a stored procedure or query must exist with the correct structures prior to the execution of the SQL. Consequently, DDL on these objects that affects structure (such as <code dir="ltr">CREATE</code> or <code dir="ltr">ALTER</code>) must execute before the <code dir="ltr">SQLEXEC</code> executes.</p>
</li>
<li>
<p>All object names in a <code dir="ltr">SQLEXEC</code> statement must be fully qualified with their two-part or three-part names, as appropriate for the database.</p>
</li>
<li>
<p>Do not use <code dir="ltr">SQLEXEC</code> for tables being processed in pass-through mode by a data-pump Extract group.</p>
</li>
<li>
<p>The following data types are supported by <code dir="ltr">SQLEXEC</code> for input and output parameters.</p>
<ul>
<li>
<p>Numeric data types</p>
</li>
<li>
<p>Date data types</p>
</li>
<li>
<p>Character data types</p>
</li>
</ul>
</li>
<li>
<p>When executed by a coordinated Replicat, <code dir="ltr">SQLEXEC</code> is executed by the thread or threads that are specified with the <code dir="ltr">THREAD</code> or <code dir="ltr">THREADRANGE</code> option of the <code dir="ltr">MAP</code> statement. However, if the <code dir="ltr">SQLEXEC</code> is specified in a <code dir="ltr">MAP</code> parameter that contains the <code dir="ltr">COORDINATED</code> keyword, it is executed as a barrier transaction automatically by the thread with the lowest ID number, regardless of the actual thread mapping.</p>
</li>
</ul>
<div class="refsubsect"><p class="titleinrefsubsect2"><a id="sthref1425"></a>Getting More Information about Using SQLEXEC in TABLE and MAP</p>
<p>For more information about how to use <code dir="ltr">SQLEXEC</code>, see <a class="olink GWUAD574" href="../../gg-winux/GWUAD/wu_customcode.htm#GWUAD574"><span class="italic">Administering Oracle GoldenGate for Windows and UNIX</span></a>.</p>
<p>For more information about <code dir="ltr">TABLE</code> and <code dir="ltr">MAP</code>, see <a href="gg_parameters160.htm#i2100527">"TABLE | MAP"</a>.</p>
</div>
<!-- class="refsubsect" -->
<div class="refsubsect"><p class="titleinrefsubsect2"><a id="sthref1426"></a>Syntax for SQLEXEC in TABLE or MAP</p>
<pre dir="ltr">
SQLEXEC (
{SPNAME <span class="italic">procedure_name</span>[, ID <span class="italic">logical_name</span>] | 
   ID <span class="codeinlineitalic">logical_name</span>, QUERY ' <span class="codeinlineitalic">SQL_query</span> '}
{, PARAMS [OPTIONAL | REQUIRED] <span class="codeinlineitalic">parameter_name</span> = {<span class="codeinlineitalic">source_column</span> | <span class="codeinlineitalic">OGG_function</span>} |
   NOPARAMS}
[, AFTERFILTER | BEFOREFILTER]
[, ALLPARAMS {OPTIONAL | REQUIRED}]
[, ERROR {IGNORE | REPORT | RAISE | FINAL | FATAL}]
[, EXEC {MAP | ONCE | TRANSACTION | SOURCEROW}][, MAXVARCHARLEN <span class="codeinlineitalic">bytes</span>]
[, PARAMBUFSIZE <span class="codeinlineitalic">bytes</span>]
[, TRACE] 
[, ...]
)
</pre>
<dl>
<dt><code dir="ltr">SPNAME</code> <code dir="ltr"><span class="codeinlineitalic">procedure_name</span></code><code dir="ltr">[, ID</code> <code dir="ltr"><span class="codeinlineitalic">logical_name</span></code><code dir="ltr">]</code></dt>
<dd>
<p>Executes a stored procedure.</p>
<dl>
<dt><code dir="ltr">SPNAME</code> <code dir="ltr"><span class="codeinlineitalic">procedure_name</span></code></dt>
<dd>
<p>Specifies the name of the procedure to execute.</p>
<p>The following example shows a single execution of a stored procedure named <code dir="ltr">lookup</code>. In this case, the actual name of the procedure is used. A logical name is not needed.</p>
<pre dir="ltr">
SQLEXEC (SPNAME lookup), PARAMS (param1 = srccol)), &amp;
COLMAP (targcol = lookup.param1);
</pre></dd>
<dt><code dir="ltr">ID</code> <code dir="ltr"><span class="codeinlineitalic">logical_name</span></code></dt>
<dd>
<p>Defines an optional logical name for the procedure. For example, logical names for a procedure named <code dir="ltr">lookup</code> might be <code dir="ltr">lookup1</code>, <code dir="ltr">lookup2</code>, and so forth. Use this option to execute the procedure multiple times within a <code dir="ltr">MAP</code> statement. A procedure can execute up to 20 times per <code dir="ltr">MAP</code> statement. <code dir="ltr">ID</code> is not required when executing a procedure once.</p>
<p>The following example shows the use of the <code dir="ltr">ID</code> option to enable multiple executions of a stored procedure that gets values from a lookup table. The values are mapped to target columns.</p>
<pre dir="ltr">
SQLEXEC (SPNAME lookup, ID lookup1, &amp;
  PARAMS (long_name = current_residence_state)), &amp;
SQLEXEC (SPNAME lookup, ID lookup2, &amp;
  PARAMS (long_name = birth_state)), &amp;
COLMAP (custid = custid, current_residence_state_long = lookup1.long_name, &amp; birth_state_long = lookup2.long_name);
</pre></dd>
</dl>
</dd>
<dt><code dir="ltr">ID</code> <code dir="ltr"><span class="codeinlineitalic">logical_name</span></code><code dir="ltr">, QUERY '</code> <code dir="ltr"><span class="codeinlineitalic">SQL_query</span></code> <code dir="ltr">'</code></dt>
<dd>
<p>Executes a query.</p>
<dl>
<dt><code dir="ltr">ID</code> <code dir="ltr"><span class="codeinlineitalic">logical_name</span></code></dt>
<dd>
<p>Defines a logical name for the query. A logical name is required in order to extract values from the query results. <code dir="ltr"><span class="codeinlineitalic">ID logical_name</span></code> references the column values returned by the query.</p>
</dd>
<dt><code dir="ltr">QUERY '</code> <code dir="ltr"><span class="codeinlineitalic">SQL_query '</span></code></dt>
<dd>
<p>Specifies the SQL query syntax to execute against the database. The query can either return results with a <code dir="ltr">SELECT</code> statement or execute an <code dir="ltr">INSERT</code>, <code dir="ltr">UPDATE</code>, or <code dir="ltr">DELETE</code> statement. A <code dir="ltr">SELECT</code> statement should only return one row. If multiple rows are returned, only the first row is processed. Do not specify an <code dir="ltr">INTO ...</code> clause for any <code dir="ltr">SELECT</code> statements.The query must be valid, standard query language for the database against which it is being executed. Most queries require placeholders for input parameters. How parameters are specified within the query depends on the database type, as follows:</p>
<ul>
<li>
<p>For Oracle, input parameters are specified by using a colon (:) followed by the parameter name, as in the following example.</p>
<pre dir="ltr">
'SELECT NAME FROM ACCOUNT WHERE SSN = :SSN AND ACCOUNT = :ACCT'
</pre></li>
<li>
<p>For other databases, input parameters are specified by using a question mark, as in the following example.</p>
<pre dir="ltr">
'SELECT NAME FROM ACCOUNT WHERE SSN = ? AND ACCOUNT = ?'
</pre></li>
</ul>
<p>The query must be contained on one line, within single quotes. Quotation marks are not required around a parameter name for any database.</p>
<p>The following examples illustrate the use of a <code dir="ltr">SQLEXEC</code> query for Oracle and SQL Server queries, respectively.</p>
<p>Oracle example:</p>
<pre dir="ltr">
MAP sales.account, TARGET sales.newacct, &amp;
  SQLEXEC (ID lookup, &amp;
  QUERY 'select desc_col into desc_param from lookup_table &amp;
  where code_col = :code_param', &amp;
  PARAMS (code_param = account_code)), &amp;
  COLMAP (newacct_id = account_id, newacct_val = lookup.desc_param);
</pre>
<p>SQL Server example:</p>
<pre dir="ltr">
MAP sales.account, TARGET sales.newacct, &amp;
  SQLEXEC (ID lookup, &amp;
  QUERY 'select desc_col into desc_param from lookup_table &amp;
  where code_col = ?', &amp;
  PARAMS (p1 = account_code)), &amp;
  COLMAP (newacct_id = account_id, &amp;
  newacct_val = lookup.desc_param);
</pre></dd>
</dl>
</dd>
<dt><code dir="ltr">PARAMS [OPTIONAL | REQUIRED]</code> <code dir="ltr"><span class="codeinlineitalic">parameter_name</span></code> <code dir="ltr">=</code> <code dir="ltr">{</code><code dir="ltr"><span class="codeinlineitalic">source_column</span></code> <code dir="ltr">|</code> <code dir="ltr"><span class="codeinlineitalic">OGG_function</span></code><code dir="ltr">}</code> <code dir="ltr">|</code></dt>
<dt><code dir="ltr">NOPARAMS</code></dt>
<dd>
<p>Defines whether or not the procedure or query accepts parameters and, if yes, maps the parameters to the input source. Either a <code dir="ltr">PARAMS</code> clause or <code dir="ltr">NOPARAMS</code> must be used.</p>
<dl>
<dt><code dir="ltr">OPTIONAL | REQUIRED</code></dt>
<dd>
<p>Determines whether or not the procedure or query executes when parameter values are missing.</p>
<p><code dir="ltr">OPTIONAL</code> indicates that a parameter value is not required for the SQL to execute. If a required source column is missing from the database operation, or if a column-conversion function cannot complete successfully because a source column is missing, the SQL executes anyway. <code dir="ltr">OPTIONAL</code> is the default for all databases except Oracle. For Oracle, whether or not a parameter is optional is automatically determined when retrieving the stored procedure definition.</p>
<p><code dir="ltr">REQUIRED</code> indicates that a parameter value must be present. If the parameter value is not present, the SQL will not be executed.</p>
</dd>
<dt><code dir="ltr"><span class="codeinlineitalic">parameter_name</span></code> <code dir="ltr">=</code> <code dir="ltr">{</code><code dir="ltr"><span class="codeinlineitalic">source_col</span></code><code dir="ltr">umn |</code> <code dir="ltr"><span class="codeinlineitalic">OGG_function</span></code><code dir="ltr">}</code></dt>
<dd>
<p>Maps the name of a parameter to a column or function that provides the input. The following data types are supported by <code dir="ltr">SQLEXEC</code> for input and output parameters.</p>
<ul>
<li>
<p>Numeric data types</p>
</li>
<li>
<p>Date data types</p>
</li>
<li>
<p>Character data types</p>
</li>
</ul>
<p><code dir="ltr"><span class="codeinlineitalic">parameter_name</span></code> is one of the following:</p>
<ul>
<li>
<p>For a stored procedure, it is the name of any parameter in the procedure that can accept input.</p>
</li>
<li>
<p>For an Oracle query, it is the name of any input parameter in the query <span class="italic">excluding</span> the leading colon. For example, <code dir="ltr">:vemplid</code> would be specified as <code dir="ltr">vemplid</code> in the <code dir="ltr">PARAMS</code> clause. Oracle permits naming an input parameter any logical name.</p>
<pre dir="ltr">
SQLEXEC (ID appphone, QUERY ' select per_type from ps_personal_data '
    ' where emplid = :vemplid '
    ' and per_status = 'N' and per_type = 'A' ',
    PARAMS (vemplid = emplid)),
TOKENS (applid = @GETVAL(appphone.per_type));
</pre></li>
<li>
<p>For a non-Oracle query, it is <code dir="ltr">P</code><code dir="ltr"><span class="codeinlineitalic">n</span></code>, where <code dir="ltr"><span class="codeinlineitalic">n</span></code> is the number of the parameter within the statement, starting from 1. For example, in a query with two parameters, the <code dir="ltr"><span class="codeinlineitalic">parameter_name</span></code> entries are <code dir="ltr">p1 and p2</code>. Consider whether the database requires the <code dir="ltr">p</code> to be upper or lower case.</p>
<pre dir="ltr">
SQLEXEC (ID appphone, QUERY ' select per_type from ps_personal_data '
    ' where emplid = ? '
    ' and per_status = 'N' and per_type = 'A' ',
    PARAMS (p1 = emplid)),
TOKENS (applid = @GETVAL(appphone.per_type));
</pre></li>
</ul>
<p><code dir="ltr"><span class="codeinlineitalic">source_column</span></code> is the name of a source column that provides the input. By default, if the specified column is not present in the log (because the record only contains the values of columns that were updated) the parameter assumes any default value specified by the procedure or query for the parameter.</p>
<p><code dir="ltr"><span class="codeinlineitalic">OGG_function</span></code> is the name of an Oracle GoldenGate column-conversion function that executes to provide the input. See <a href="column_conversion_functions.htm#i1110551">"Column Conversion Functions"</a>.</p>
</dd>
</dl>
<p>To pass output values from the stored procedure or query as input to a <code dir="ltr">FILTER</code> or <code dir="ltr">COLMAP</code> clause, use the following syntax:</p>
<pre dir="ltr">
{<span class="italic">procedure_name</span> | <span class="italic">logical_name</span>}.<span class="italic">parameter</span>
</pre>
<p>Where:</p>
<ul>
<li>
<p><code dir="ltr"><span class="codeinlineitalic">procedure_name</span></code> is the actual name of a stored procedure, which must match the value given for <code dir="ltr">SPNAME</code> in the <code dir="ltr">SQLEXEC</code> statement. Use this argument only if executing a procedure one time during the course of the Oracle GoldenGate run.</p>
</li>
<li>
<p><code dir="ltr"><span class="codeinlineitalic">logical_name</span></code> is the logical name specified with the <code dir="ltr">ID</code> option of <code dir="ltr">SQLEXEC</code>. Use this argument to pass input values from either a query or an instance of a stored procedure when the procedure executes multiple times within a <code dir="ltr">MAP</code> statement.</p>
</li>
<li>
<p><code dir="ltr"><span class="codeinlineitalic">parameter</span></code> is the name of a parameter or <code dir="ltr">RETURN_VALUE</code> if extracting returned values. By default, output values are truncated at 255 bytes per parameter. If output parameters must be longer, use the <code dir="ltr">MAXVARCHARLEN</code> option.</p>
</li>
</ul>
<div class="infobox-note">
<p class="notep1">Note:</p>
As an alternative to the preceding syntax, you can use the <code dir="ltr">@GETVAL</code> function. See <a href="column_conversion_functions016.htm#i1036835">"GETVAL"</a> for more information.</div>
<p>The following examples apply to a set of Oracle source and target tables and a lookup table. These examples show how parameters for the tables are passed for a single instance of a stored procedure and multiple instances of a stored procedure.</p>
<p><span class="bold">Source table cust:</span></p>
<pre dir="ltr">
custid                     Number
current_residence_state    Char(2)
birth_state                Char(2)
</pre>
<p><span class="bold">Target table cust_extended:</span></p>
<pre dir="ltr">
custid                          Number
current_residence_state_long    Varchar(30)
birth_state_long                Varchar(30)
</pre>
<p><span class="bold">Lookup table state_lookup</span></p>
<pre dir="ltr">
abbreviation     Char(2)
long_name        Varchar(30)
</pre>
<p>The following example shows the use of a stored procedure that executes once to get a value from the lookup table. When processing records from the <code dir="ltr">cust</code> table, Oracle GoldenGate executes the <code dir="ltr">lookup</code> stored procedure before executing the column map. The <code dir="ltr">long_name</code> parameter in the procedure accepts input from the <code dir="ltr">birth_state</code> source column.The value is mapped to the target column <code dir="ltr">birth_state_long</code> in the <code dir="ltr">COLMAP</code> statement.</p>
<pre dir="ltr">
MAP sales.cust, TARGET sales.cust_extended, &amp;
SQLEXEC (SPNAME lookup, &amp;
PARAMS (long_name = birth_state)), &amp;
COLMAP (custid = custid, &amp;
birth_state_long = lookup.long_name);
</pre>
<p>The following example shows the use of the <code dir="ltr">ID</code> option to enable multiple executions of a stored procedure that gets values from a lookup table. The values are mapped to target columns.</p>
<pre dir="ltr">
MAP sales.cust, TARGET sales.cust_extended, &amp;
SQLEXEC (SPNAME lookup, ID lookup1, &amp;
PARAMS (long_name = current_residence_state)), &amp;
SQLEXEC (SPNAME lookup, ID lookup2, &amp;
PARAMS (long_name = birth_state)), &amp;
COLMAP (custid = custid, current_residence_state_long = lookup1.long_name, &amp; birth_state_long = lookup2.long_name);
</pre></dd>
</dl>
<dl>
<dt><code dir="ltr">AFTERFILTER | BEFOREFILTER</code></dt>
<dd>
<p>Use <code dir="ltr">AFTERFILTER</code> and <code dir="ltr">BEFOREFILTER</code> to specify when to execute the stored procedure or query in relation to the <code dir="ltr">FILTER</code> clause of a <code dir="ltr">MAP</code> statement.</p>
<dl>
<dt><code dir="ltr">AFTERFILTER</code></dt>
<dd>
<p>Causes the SQL to execute after the <code dir="ltr">FILTER</code> statement. This enables you to skip the overhead of executing the SQL unless the filter is successful. This is the default.</p>
</dd>
<dt><code dir="ltr">BEFOREFILTER</code></dt>
<dd>
<p>Causes the SQL to execute before the <code dir="ltr">FILTER</code> statement, so the results can be used in the filter.</p>
</dd>
</dl>
</dd>
</dl>
<p>The following is an example using <code dir="ltr">BEFOREFILTER</code>.</p>
<pre dir="ltr">
SQLEXEC (SPNAME check, NOPARAMS, BEFOREFILTER)
</pre>
<dl>
<dt><code dir="ltr">ALLPARAMS [OPTIONAL | REQUIRED]</code></dt>
<dd>
<p>Use <code dir="ltr">ALLPARAMS</code> as a global rule that determines whether or not all of the specified parameters must be present for the stored procedure or query to execute. Rules for individual parameters established within the <code dir="ltr">PARAMS</code> clause override the global rule set with <code dir="ltr">ALLPARAMS</code>.</p>
<dl>
<dt><code dir="ltr">OPTIONAL</code></dt>
<dd>
<p>Permits the SQL to execute whether or not all of the parameters are present. This is the default.</p>
</dd>
<dt><code dir="ltr">REQUIRED</code></dt>
<dd>
<p>Requires all of the parameters to be present for the SQL to execute.</p>
</dd>
</dl>
</dd>
</dl>
<p>The following is an example using <code dir="ltr">OPTIONAL</code>.</p>
<pre dir="ltr">
SQLEXEC (SPNAME lookup,
PARAMS (long_name = birth_state, short_name = state),
ALLPARAMS OPTIONAL)
</pre>
<dl>
<dt><code dir="ltr">ERROR {IGNORE | REPORT | RAISE | FINAL | FATAL}</code></dt>
<dd>
<p>Use <code dir="ltr">ERROR</code> to define a response to errors associated with the stored procedure or query. Without explicit error handling, the Oracle GoldenGate process abends on errors. Make certain your procedures return errors to the process and specify the responses with <code dir="ltr">ERROR</code>.</p>
<dl>
<dt><code dir="ltr">IGNORE</code></dt>
<dd>
<p>Causes Oracle GoldenGate to ignore all errors associated with the stored procedure or query and continue processing. Any resulting parameter extraction results in "column missing" conditions. This is the default.</p>
</dd>
<dt><code dir="ltr">REPORT</code></dt>
<dd>
<p>Ensures that all errors associated with the stored procedure or query are reported to the discard file. The report is useful for tracing the cause of the error. It includes both an error description and the value of the parameters passed to and from the procedure or query. Oracle GoldenGate continues processing after reporting the error.</p>
</dd>
<dt><code dir="ltr">RAISE</code></dt>
<dd>
<p>Handles errors according to rules set by a <code dir="ltr">REPERROR</code> parameter. Oracle GoldenGate continues processing other stored procedures or queries associated with the current <code dir="ltr">MAP</code> statement before processing the error.</p>
</dd>
<dt><code dir="ltr">FINAL</code></dt>
<dd>
<p>Is similar to <code dir="ltr">RAISE</code> except that when an error associated with a procedure or query is encountered, remaining stored procedures and queries are bypassed. Error processing is invoked immediately after the error.</p>
</dd>
<dt><code dir="ltr">FATAL</code></dt>
<dd>
<p>Causes Oracle GoldenGate to abend immediately upon encountering an error associated with a procedure or query.</p>
</dd>
</dl>
</dd>
</dl>
<dl>
<dt><code dir="ltr">EXEC {MAP | ONCE | TRANSACTION | SOURCEROW}</code></dt>
<dd>
<p>Use <code dir="ltr">EXEC</code> to control the frequency with which a stored procedure or query in a <code dir="ltr">MAP</code> statement executes and how long the results are considered valid, if extracting output parameters.</p>
<dl>
<dt><code dir="ltr">MAP</code></dt>
<dd>
<p>Executes the procedure or query once for each source-target table map for which it is specified. Using <code dir="ltr">MAP</code> renders the results invalid for any subsequent maps that have the same source table. <code dir="ltr">MAP</code> is the default.</p>
<p>The following example shows the incorrect use of the default of <code dir="ltr">MAP</code>. Because <code dir="ltr">MAP</code> is the default, it need not be explicitly listed in the <code dir="ltr">SQLEXEC</code> statement. In this example, a source table is mapped in separate <code dir="ltr">MAP</code> parameters to two different target tables. In this case, the results are valid only for the first mapping. The results of the procedure <code dir="ltr">lookup</code> are expired by the time the second <code dir="ltr">MAP</code> parameter executes, and the second <code dir="ltr">MAP</code> results in a "column missing" condition. To implement this correctly so that each <code dir="ltr">MAP</code> returns valid results, <code dir="ltr">SOURCEROW</code> should be used.</p>
<pre dir="ltr">
MAP sales.srctab, TARGET sales.targtab, &amp;
SQLEXEC (SPNAME lookup, PARAMS (param1 = srccol)), &amp;
COLMAP (targcol = lookup.param2);

MAP sales.srctab, TARGET sales.targtab2, &amp;
COLMAP (targcol2 = lookup.param2);
</pre></dd>
<dt><code dir="ltr">ONCE</code></dt>
<dd>
<p>Executes the procedure or query once during the course of the Oracle GoldenGate run, upon the first invocation of the associated <code dir="ltr">MAP</code> statement. The results remain valid for as long as the process remains running.</p>
<p>The following is an example of using <code dir="ltr">ONCE</code>.</p>
<pre dir="ltr">
MAP sales.cust, TARGET sales.cust_extended, &amp;
SQLEXEC (SPNAME lookup, PARAMS (long_name = birth_state), EXEC ONCE), &amp;
COLMAP (custid = custid, &amp;
birth_state_long = lookup.long_name);
</pre></dd>
<dt><code dir="ltr">TRANSACTION</code></dt>
<dd>
<p>Executes the procedure or query once per source transaction. The results remain valid for all operations of the transaction.</p>
<p>The following is an example of using <code dir="ltr">TRANSACTION</code>.</p>
<pre dir="ltr">
MAP sales.cust, TARGET sales.cust_extended, &amp;
SQLEXEC (SPNAME lookup, PARAMS (long_name = birth_state), EXEC TRANSACTION), &amp;
COLMAP (custid = custid, &amp;
birth_state_long = lookup.long_name);
</pre></dd>
<dt><code dir="ltr">SOURCEROW</code></dt>
<dd>
<p>Executes the procedure or query once per source row operation. Use this option when you are synchronizing a source table with more than one target table, so that the results of the procedure or query are invoked for each source-target mapping.</p>
<p>The following is an example of using <code dir="ltr">SOURCEROW</code>. In this case, the second map returns a valid value because the procedure executes on every source row operation.</p>
<pre dir="ltr">
MAP sales.srctab, TARGET sales.targtab, &amp;
SQLEXEC (SPNAME lookup, PARAMS (param1 = srccol), EXEC SOURCEROW), &amp;
COLMAP (targcol = lookup.param2);

MAP sales.srctab, TARGET sales.targtab2, &amp;
COLMAP (targcol2 = lookup.param2);
</pre></dd>
</dl>
</dd>
</dl>
<a id="BABCGJBB"></a>
<dl>
<dt><code dir="ltr">MAXVARCHARLEN</code> <code dir="ltr"><span class="codeinlineitalic">bytes</span></code></dt>
<dd>
<p>Use <code dir="ltr">MAXVARCHARLEN</code> to specify the maximum byte length allocated for the output value of any parameter in a stored procedure or query. Beyond this maximum, the output values are truncated. The default is 255 bytes without an explicit <code dir="ltr">MAXVARCHARLEN</code> clause. The valid range of values is from 50 to 32767 bytes, except for Oracle TimesTen. The maximum output value for Oracle TimesTen is 2560 bytes.</p>
<p>The following example limits the byte length of output values to 100.</p>
<pre dir="ltr">
MAXVARCHARLEN 100
</pre></dd>
</dl>
<dl>
<dt><code dir="ltr">PARAMBUFSIZE</code> <code dir="ltr"><span class="codeinlineitalic">bytes</span></code></dt>
<dd>
<p>Use <code dir="ltr">PARAMBUFSIZE</code> to specify the maximum number of bytes allowed for the memory buffer that stores <code dir="ltr">SQLEXEC</code> parameter information, including both input and output parameters. The default is 10,000 bytes without an explicit <code dir="ltr">PARAMBUFSIZE</code> clause. The valid range of values is from 1000 to 2000000 bytes. Oracle GoldenGate issues a warning whenever the memory allocated for parameters is within 500 bytes of the maximum.</p>
<p>The following example increases the buffer to 15,000 bytes.</p>
<pre dir="ltr">
PARAMBUFSIZE 15000
</pre></dd>
</dl>
<dl>
<dt><code dir="ltr">TRACE {ALL | ERROR}</code></dt>
<dd>
<p>Use <code dir="ltr">TRACE</code> to log <code dir="ltr">SQLEXEC</code> input and output parameters to the report file.</p>
<p>The following is a sample report file with <code dir="ltr">SQLEXEC</code> tracing enabled:</p>
<pre dir="ltr">
Input parameter values...
LMS_TABLE: INTERACTION_ATTR_VALUES
   KEY1: 2818249
  KEY2: 1
Report File:
From Table MASTER.INTERACTION_ATTR_VALUES to MASTER.INTERACTION_ATTR_VALUES:
       #  inserts:      0
       #  updates:      0
       #  deletes:      0
       #  discards:     1

  Stored procedure GGS_INTERACTION_ATTR_VALUES:
       attempts:        2
       successful:      0
</pre>
<dl>
<dt><code dir="ltr">ALL</code></dt>
<dd>
<p>Writes the input and output parameters for each invocation of the procedure or query to the report file. This is the default.</p>
</dd>
<dt><code dir="ltr">ERROR</code></dt>
<dd>
<p>Writes the input and output parameters for each invocation of the procedure or query to the report file only after a SQL error occurs.</p>
</dd>
</dl>
</dd>
</dl>
</div>
<!-- class="refsubsect" --></div>
<!-- class="refsubsect" --></div>
<!-- class="refsect1" --></div>
<!-- class="refentry" -->
<div class="refentry"></div>
<!-- class="ind" -->
<!-- Start Footer -->
</div>
<!-- add extra wrapper close div-->
<footer><!--
<hr />
<table class="cellalignment135">
<tr>
<td class="cellalignment142"><table class="cellalignment140">
<tr>
<td class="cellalignment139"><a href="gg_parameters155.htm"><img width="24" height="24" src="../../dcommon/gifs/leftnav.gif" alt="Go to previous page" /><br />
<span class="icon">Previous</span></a></td>

<td class="cellalignment139"><a href="gg_parameters157.htm"><img width="24" height="24" src="../../dcommon/gifs/rightnav.gif" alt="Go to next page" /><br />
<span class="icon">Next</span></a></td>
</tr>
</table></td>
<td class="cellalignment-copyrightlogo"><img width="144" height="18" src="../../dcommon/gifs/oracle.gif" alt="Oracle" /><br />
Copyright&nbsp;&copy;&nbsp;2013, 2015,&nbsp;Oracle&nbsp;and/or&nbsp;its&nbsp;affiliates.&nbsp;All&nbsp;rights&nbsp;reserved.<br />
<a href="../../dcommon/html/cpyr.htm">Legal Notices</a></td>
<td class="cellalignment144">
<table class="cellalignment138">
<tr>
<td class="cellalignment139"><a href="../../index.html"><img width="24" height="24" src="../../dcommon/gifs/doclib.gif" alt="Go to Documentation Home" /><br />
<span class="icon">Home</span></a></td>
<td class="cellalignment139"><a href="toc.htm"><img width="24" height="24" src="../../dcommon/gifs/toc.gif" alt="Go to Table of Contents" /><br />
<span class="icon">Contents</span></a></td>
<td class="cellalignment139"><a href="../../dcommon/html/feedback.htm"><img width="24" height="24" src="../../dcommon/gifs/feedbck2.gif" alt="Go to Feedback page" /><br />
<span class="icon">Contact Us</span></a></td>
</tr>
</table>
</td>
</tr>
</table>
--></footer>
<noscript>
<p>Scripting on this page enhances content navigation, but does not change the content in any way.</p>
</noscript>
</body>
</html>
